<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Pandas系列1-DataFrame之初始化 | Geekpy's Blog</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">Geekpy's Blog</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a><a href="/about" class="sidebar-nav-item">About</a></div></nav><div id="header-margin-bar"></div><div class="wrapper"><div class="container post-header"><h1>Pandas系列1-DataFrame之初始化</h1></div></div><article><div class="container post"><p>Pandas中如果要初始化DataFrame对象，实际又很多种方式，本文将详解Pandas初始化的几种不同方式。</p>
<p>&lt;!--more--&gt;</p>
<p>DataFrame有多种初始化方法，主要分为以下几种情况：</p>
<ul>
<li>通过Object初始化</li>
<li>通过文件初始化</li>
<li>通过SQL查询结果初始化</li>
<li>通过NoSQL数据库查询结果初始化</li>
</ul>
<p>下面分别介绍：</p>
<h2>通过object初始化</h2>
<p>这又分为以下几种方式</p>
<ul>
<li>Dict of 1D ndarrays, lists, dicts, or Series</li>
<li>2-D numpy.ndarray</li>
<li>Structured or record ndarray</li>
<li>A Series</li>
<li>Another DataFrame</li>
</ul>
<h4>通过list</h4>
<p>通过1D data series初始化的时候，如果有多列，那么需要等长
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># columns参数是通过一个list参数来指定column labels</span><br><span class="line">df = pd.DataFrame([[&apos;a1&apos;, 1], [&apos;a2&apos;, 4]], columns=[&apos;uid&apos;, &apos;score&apos;])</span><br><span class="line">In [477]: df</span><br><span class="line">Out[477]:</span><br><span class="line">  uid  score</span><br><span class="line">0  a1      1</span><br><span class="line">1  a2      4</span><br></pre></td></tr></table></figure></p>
<h4>通过Dict of 1D ndarray</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [298]: df = pd.DataFrame(&#123;&apos;col1&apos;: np.arange(3), &apos;col2&apos;: np.arange(5, 8)&#125;)</span><br><span class="line"></span><br><span class="line">In [299]: df</span><br><span class="line">Out[299]:</span><br><span class="line">   col1  col2</span><br><span class="line">0     0     5</span><br><span class="line">1     1     6</span><br><span class="line">2     2     7</span><br></pre></td></tr></table></figure></p>
<h4>通过Dict of lists</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [294]: df = pd.DataFrame(&#123;&apos;col1&apos;: [1, 2, 3, 4], &apos;col2&apos;: [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;]&#125;)</span><br><span class="line"></span><br><span class="line">In [295]: df</span><br><span class="line">Out[295]:</span><br><span class="line">   col1 col2</span><br><span class="line">0     1    a</span><br><span class="line">1     2    b</span><br><span class="line">2     3    c</span><br><span class="line">3     4    d</span><br></pre></td></tr></table></figure></p>
<h4>通过list of dicts</h4>
<p>注意与上边的dict of lists区分，如果最外层是dict，那么key值默认是column label。
而在list of dicts中，每个dict都是一个record，或者说一行
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 可以不等长，缺失值自动设为NaN</span><br><span class="line">In [49]: data2 = [&#123;&apos;a&apos;: 1, &apos;b&apos;: 2&#125;, &#123;&apos;a&apos;: 5, &apos;b&apos;: 10, &apos;c&apos;: 20&#125;]</span><br><span class="line"></span><br><span class="line">In [50]: pd.DataFrame(data2)</span><br><span class="line">Out[50]: </span><br><span class="line">   a   b     c</span><br><span class="line">0  1   2   NaN</span><br><span class="line">1  5  10  20.0</span><br><span class="line"></span><br><span class="line">In [51]: pd.DataFrame(data2, index=[&apos;first&apos;, &apos;second&apos;])</span><br><span class="line">Out[51]: </span><br><span class="line">        a   b     c</span><br><span class="line">first   1   2   NaN</span><br><span class="line">second  5  10  20.0</span><br><span class="line"></span><br><span class="line">In [52]: pd.DataFrame(data2, columns=[&apos;a&apos;, &apos;b&apos;])</span><br><span class="line">Out[52]: </span><br><span class="line">   a   b</span><br><span class="line">0  1   2</span><br><span class="line">1  5  10</span><br></pre></td></tr></table></figure></p>
<h4>通过Dict of Series</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">In [314]: s = pd.Series(range(5))</span><br><span class="line"></span><br><span class="line">In [315]: s</span><br><span class="line">Out[315]:</span><br><span class="line">0    0</span><br><span class="line">1    1</span><br><span class="line">2    2</span><br><span class="line">3    3</span><br><span class="line">4    4</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [316]: p = pd.Series(range(8, 13))</span><br><span class="line"></span><br><span class="line">In [317]: p</span><br><span class="line">Out[317]:</span><br><span class="line">0     8</span><br><span class="line">1     9</span><br><span class="line">2    10</span><br><span class="line">3    11</span><br><span class="line">4    12</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [318]: df = pd.DataFrame(&#123;&apos;a&apos;: s, &apos;b&apos;: p&#125;)</span><br><span class="line"></span><br><span class="line">In [319]: df</span><br><span class="line">Out[319]:</span><br><span class="line">   a   b</span><br><span class="line">0  0   8</span><br><span class="line">1  1   9</span><br><span class="line">2  2  10</span><br><span class="line">3  3  11</span><br><span class="line">4  4  12</span><br></pre></td></tr></table></figure></p>
<h4>通过2-D numpy.ndarray</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [289]: df = pd.DataFrame(np.arange(16).reshape((4,4)), columns=[&apos;one&apos;, &apos;two&apos;, &apos;three&apos;,</span><br><span class="line">     ...:  &apos;four&apos;], index=[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;,&apos;d&apos;])</span><br><span class="line"></span><br><span class="line">In [290]: df</span><br><span class="line">Out[290]:</span><br><span class="line">   one  two  three  four</span><br><span class="line">a    0    1      2     3</span><br><span class="line">b    4    5      6     7</span><br><span class="line">c    8    9     10    11</span><br><span class="line">d   12   13     14    15</span><br></pre></td></tr></table></figure></p>
<h2>通过文件初始化</h2>
<p>pandas通过各种数据文件也可以初始化，比如csv文件，excel文件，json文件，html文件等，详见下图
<img src="https://upload-images.jianshu.io/upload_images/3959253-4ebb77efcd970e59.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IO Tools"></p>
<p>下面以<code>read_csv</code>详细解释下读取csv文件以及初始化的过程
<code>read_csv</code>的完整文档参考<a href="https://pandas.pydata.org/pandas-docs/version/0.22/generated/pandas.read_csv.html#pandas.read_csv" target="_blank" rel="noopener">read_csv api</a>，下面通过示例对常用的parameter进行解释：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">csv_path = &quot;./test.csv&quot;</span><br><span class="line">columns = [&apos;id&apos;, &apos;name&apos;, &apos;age&apos;]</span><br><span class="line">dtype = &#123;&apos;id&apos;: int, &apos;name&apos;: object, &apos;age&apos;: int&#125;</span><br><span class="line">pd.read_csv(csv_path, header=None, names=columns, dtype=dtype)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>filepath_or_buffer, 这个是最基本的参数，用以指明文件的路径(路径可以是字符串，也可以是各种path对象，详见文档)或者文件对象(也可以接收类文件对象, 即提供read method， 如StringIO对象)。另外，这个参数也可以是一个URL，而这个URL可以http, ftp, 或者s3的url.</li>
</ul>
<blockquote>
<p>对于没有权限限制的url，直接使用read_csv可以大大简化代码，但是通过我们的数据不会放置到公开的url地址上，因此这就涉及权限的问题，通常还是通过其它手段将文件下载到本地后再读取。</p>
</blockquote>
<ul>
<li>header, 这个参数用于设置第几行为column names, 默认是'infer'，即Pandas会自动推断哪一行是column names。当文件中没有column names时，相当于设定header=0。很多时候想要忽略原始的column names而自己设定column names，那么可以将这个参数设置为None, 然后通过names参数来设定column names</li>
<li>names, 用于设定column names</li>
<li>dtype, 用于设定每一列对应的数据类型，需要注意的是对string类型需要设置为object</li>
<li>nrows, 要读取多少行，通过这个参数我们可以部分读取文件</li>
<li>usecols, 用于选定列，即指定哪些列load进DataFrame中，通过这个参数可以只读取我们需要的数据，从而减少内存占用，加快load速度。</li>
</ul>
<h2>通过SQL查询结果初始化</h2>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import pandas.io.sql as sql</span><br><span class="line"></span><br><span class="line"># conn是数据库的连接对象</span><br><span class="line">sql.read_frame(&apos;select * from test&apos;, conn)</span><br></pre></td></tr></table></figure></p>
<h2>NoSQL查询结果初始化</h2>
<p>这里以MongoDB为例
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 从MongoDB中查询年龄大于20岁的用户，查询返回一个cursor对象</span><br><span class="line">user_results = user.find(&#123;&quot;age&quot;: &#123;&quot;$gt&quot;: 20&#125;&#125;)</span><br><span class="line"></span><br><span class="line"># 将cursor对象转化为list，然后初始化</span><br><span class="line"># columns可以用于选取相应的field的数据，只有在这个列表中的field才会被load进DataFrame对象当中，如果没有对应的数据，会被填入NaN</span><br><span class="line">df = pd.DataFrame(list(user_results), columns=[&apos;id&apos;, &apos;age&apos;, &apos;name&apos;]</span><br></pre></td></tr></table></figure></p>
<p>这里需要注意的是如果不指定columns参数，有可能导致某些为空的field没有对应的列，如果指定了列名称，则如果相对应的域没有数据的话，就会自动置为nan</p>
<h2>References</h2>
<ul>
<li><a href="https://pandas.pydata.org/pandas-docs/version/0.22/generated/pandas.read_csv.html#pandas.read_csv" target="_blank" rel="noopener">read_csv API</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/version/0.22/io.html#io-read-csv-table" target="_blank" rel="noopener">IO Tools</a></li>
<li>《利用Python进行数据分析》</li>
</ul>
</div><div class="container"><hr><div class="comment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//cdn.jsdelivr.net/npm/valine@1.1.6/dist/Valine.min.js"></script>
<script type="text/javascript">
var leancloud_appid = 'OCjgmQiFa9gpVkDabM6KTb8g-gzGzoHsz';
var leancloud_appkey = 'Ie7XE2V6spB6Q6C1W2GU9drV';
var valine_url = 'http://yoursite.com/2018/06/08/Pandas系列1-DataFrame之初始化/';
var valine_notify = false;
var valine_verify = false;
var valine_placeholder = '';
new Valine({
         av: AV, // source from av-min.js
         el: '.comment' ,
         notify: valine_notify,
         verify: valine_verify,
         app_id: leancloud_appid,
         app_key: leancloud_appkey,
         placeholder: valine_placeholder,
         path: valine_url
     });
</script></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:rebor.liu@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="https://github.com/geekpy" target="_blank"><i class="fa fa-github"></i></a></div><div class="footer">© 2018 <a href="/" rel="nofollow">geekpy</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>