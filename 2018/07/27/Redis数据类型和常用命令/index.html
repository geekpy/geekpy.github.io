<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Redis数据类型和常用命令 | Geekpy's Blog</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">Geekpy's Blog</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a><a href="/about" class="sidebar-nav-item">About</a></div></nav><div id="header-margin-bar"></div><div class="wrapper"><div class="container post-header"><h1>Redis数据类型和常用命令</h1></div></div><article><div class="container post"><p>Redis相较于其它的数据库虽然简单，但是要熟记所有命令的用法也并非易事。一个简单的技巧是通过要操作的数据类型来将这些命令进行结构化。</p>
<p>&lt;!--more--&gt;</p>
<h2>数据类型和对应命令</h2>
<p>所有存储于redis中的数据都对应于一个键值对(key-value pair), key可以是任意二进制序列，通常我们使用字符串来标记一个特定的key。在redis中我们通常称这个key为name或者就叫key, 而对于value，redis支持如下几种类型：</p>
<ul>
<li>strings</li>
<li>lists: list内容只能是string</li>
<li>sets: set中存储非重复的string</li>
<li>sorted sets: 与sets类似，但是每个string都会对应一个float类型的score，从而用于排序</li>
<li>hashes: 键值对hash类型，也就是Python中的dict，注意在redis中最外层的key一般叫做name或者key，而value中数据类型如果是dict，那么这个dict中的key通常被称为field。</li>
<li>Bit arrays (or simply bitmaps): 实际存储的仍然是string，但是可以针对bit进行操作</li>
<li>HyperLogLogs: 用于估计unique value的数量</li>
</ul>
<p>针对不同的数据类型，会有不同的命令，通过如下脑图可以更加清晰地记忆redis的命令
<img src="https://upload-images.jianshu.io/upload_images/3959253-6c756bf39ad702c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Redis数据类型与常用命令"></p>
<h4>strings</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set strtest xyz</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get strtest</span><br><span class="line">&quot;xyz&quot;</span><br><span class="line">127.0.0.1:6379&gt; mset a 1 b 2 c 3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget a b c</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line"># 注意以下增减操作只能针对整数数字(虽然类型仍然是string类型)</span><br><span class="line">127.0.0.1:6379&gt; incr a</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; incrby b 5</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379&gt; decr b</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; decrby b 3</span><br><span class="line">(integer) 3</span><br></pre></td></tr></table></figure></p>
<h4>lists</h4>
<p>lists类型中存储的仍然是string类型
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># left push用于从左将item压入到list当中</span><br><span class="line">127.0.0.1:6379&gt; lpush list_test 1 2 3</span><br><span class="line">(integer) 3</span><br><span class="line"></span><br><span class="line"># 注意如果想看list中的内容，无法通过get直接去看，get只是针对string，而必须使用lrange</span><br><span class="line">127.0.0.1:6379&gt; get list_test </span><br><span class="line">(error) WRONGTYPE Operation against a key holding the wrong kind of value</span><br><span class="line"></span><br><span class="line"># 这里0 -1均为list index，表示从index 0 开始到-1结束，-1即从右数最后一个item</span><br><span class="line">127.0.0.1:6379&gt; lrange list_test 0 -1</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;1&quot;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; rpush list_test 5 7</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; lrange list_test 0 -1</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;1&quot;</span><br><span class="line">4) &quot;5&quot;</span><br><span class="line">5) &quot;7&quot;</span><br><span class="line">127.0.0.1:6379&gt; lpop list_test</span><br><span class="line">&quot;3&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange list_test 0 -1</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;5&quot;</span><br><span class="line">4) &quot;7&quot;</span><br><span class="line"></span><br><span class="line"># 从左trim截断list，以下是截取index 0 到index 2 的item作为新的list</span><br><span class="line">127.0.0.1:6379&gt; ltrim list_test 0 2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange list_test 0 -1</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;5&quot;</span><br></pre></td></tr></table></figure></p>
<h4>hashes (dict)</h4>
<p>哈希类型，在python中也就是dict类型。这也是非常常用的数据类型。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset htest a 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hget htest a</span><br><span class="line">&quot;1&quot;</span><br><span class="line">127.0.0.1:6379&gt; hmset htest a 1 b 2 c 3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hmget htest a b c</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">127.0.0.1:6379&gt; hgetall htest</span><br><span class="line">1) &quot;a&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;b&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;c&quot;</span><br><span class="line">6) &quot;3&quot;</span><br><span class="line">127.0.0.1:6379&gt; hkeys htest</span><br><span class="line">1) &quot;a&quot;</span><br><span class="line">2) &quot;b&quot;</span><br><span class="line">3) &quot;c&quot;</span><br><span class="line">127.0.0.1:6379&gt; hvals htest</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;3&quot;</span><br></pre></td></tr></table></figure></p>
<p>在python程序中使用redis-py driver的时候，通过dict进行操作会非常清晰和简单。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import redis</span><br><span class="line"></span><br><span class="line">In [2]: r = redis.StrictRedis(host=&apos;localhost&apos;, port=6379, db=0)</span><br><span class="line"></span><br><span class="line">In [3]: d = &#123;&quot;a&quot;: 2, &quot;b&quot;: 3&#125;</span><br><span class="line"></span><br><span class="line">In [4]: key = &quot;test:2&quot;</span><br><span class="line"></span><br><span class="line">In [5]: r.hmset(key, d)</span><br><span class="line">Out[5]: True</span><br><span class="line"></span><br><span class="line">In [6]: r.hgetall(key)</span><br><span class="line">Out[6]: &#123;&apos;a&apos;: &apos;2&apos;, &apos;b&apos;: &apos;3&apos;&#125;</span><br></pre></td></tr></table></figure></p>
<h4>sets</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd set_test a b 33</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; sadd set_test c a b 22</span><br><span class="line">(integer) 1</span><br><span class="line"></span><br><span class="line"># 可以看到不会有重复的item</span><br><span class="line">127.0.0.1:6379&gt; smembers set_test</span><br><span class="line">1) &quot;c&quot;</span><br><span class="line">2) &quot;33&quot;</span><br><span class="line">3) &quot;a&quot;</span><br><span class="line">4) &quot;b&quot;</span><br><span class="line"></span><br><span class="line"># 用于测试set中是否包含指定的item，如有则返回1，没有返回0</span><br><span class="line">127.0.0.1:6379&gt; sismember set_test a</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sismember set_test xx</span><br><span class="line">(integer) 0</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; sadd set_test2 a b 56 66</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; smembers set_test2</span><br><span class="line">1) &quot;56&quot;</span><br><span class="line">2) &quot;a&quot;</span><br><span class="line">3) &quot;66&quot;</span><br><span class="line">4) &quot;b&quot;</span><br><span class="line"></span><br><span class="line"># 求交集</span><br><span class="line">127.0.0.1:6379&gt; sinter set_test set_test2</span><br><span class="line">1) &quot;a&quot;</span><br><span class="line">2) &quot;b&quot;</span><br><span class="line"></span><br><span class="line"># 求并集</span><br><span class="line">127.0.0.1:6379&gt; sunion set_test set_test2</span><br><span class="line">1) &quot;33&quot;</span><br><span class="line">2) &quot;a&quot;</span><br><span class="line">3) &quot;56&quot;</span><br><span class="line">4) &quot;c&quot;</span><br><span class="line">5) &quot;66&quot;</span><br><span class="line">6) &quot;22&quot;</span><br><span class="line">7) &quot;b&quot;</span><br></pre></td></tr></table></figure></p>
<h4>sorted sets</h4>
<p>sorted sets与sets类似，可以保证item不重复，区别在于sorted sets中每个item对应一个float类型的score
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd sort_set 2.2 a</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd sort_set 2 bb</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd sort_set 10 x</span><br><span class="line">(integer) 1</span><br><span class="line"></span><br><span class="line"># 获取index 从0 到-1的(即所有) items</span><br><span class="line">127.0.0.1:6379&gt; zrange sort_set 0 -1</span><br><span class="line">1) &quot;bb&quot;</span><br><span class="line">2) &quot;a&quot;</span><br><span class="line">3) &quot;x&quot;</span><br><span class="line"></span><br><span class="line"># 获取item bb对应的index</span><br><span class="line">127.0.0.1:6379&gt; zrank sort_set bb</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; zrank sort_set x</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; zscore sort_set x</span><br><span class="line">&quot;10&quot;</span><br><span class="line"></span><br><span class="line"># 用于获取对应score set中item的数量</span><br><span class="line">127.0.0.1:6379&gt; zcard sort_set</span><br><span class="line">(integer) 3</span><br></pre></td></tr></table></figure></p>
<h4>bit arrays</h4>
<p>用于针对指定的key设置位数据为0 或 1。当我们对存储有较高要求，且对于统计为1的item的数量时，使用bit array是一个好的办法。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 针对bit 7进行设置，设置为1，返回该位之前存储的值</span><br><span class="line">127.0.0.1:6379&gt; setbit bit_test 7 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit bit_test 7 0</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; get bit_test</span><br><span class="line">&quot;\x00&quot;</span><br><span class="line">127.0.0.1:6379&gt; setbit bit_test 8 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit bit_test 9 1</span><br><span class="line">(integer) 0</span><br><span class="line"></span><br><span class="line"># 统计有多少位为1</span><br><span class="line">127.0.0.1:6379&gt; bitcount bit_test</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure></p>
<h4>HyperLogLogs</h4>
<p>redis实现了相应算法可以估计hyperloglog中存储的所有item中非重复的item的数量
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; pfadd loglog 1 3 5 7 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount loglog</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure></p>
<h2>通用的命令</h2>
<ul>
<li>keys pattern: pattern可以为glob风格的通配符格式，最常用的是<code>keys *</code>查询所有的keys</li>
<li>exists key: 查询该key是否存在</li>
<li>del key: 删除该key对应的数据</li>
<li>type key: 查询该key对应的value的数据类型</li>
<li>expire key: 定义多长时间后key对应的数据过期，过期后数据会被自动删除</li>
<li>ttl key: 查询该key对应的剩余存活时间</li>
<li>flushdb/flushall: flushdb用于清除当前db的所有数据，flushall清除所有数据库的数据</li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://redis.io/topics/data-types-intro" target="_blank" rel="noopener">Redis Type Introduction</a></li>
<li><a href="https://redis.io/commands#" target="_blank" rel="noopener">Redis Commands</a></li>
<li><a href="https://segmentfault.com/a/1190000010999677" target="_blank" rel="noopener">Redis 常用命令</a></li>
</ul>
</div><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:rebor.liu@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="https://github.com/geekpy" target="_blank"><i class="fa fa-github"></i></a></div><div class="footer">© 2018 <a href="/" rel="nofollow">geekpy</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>