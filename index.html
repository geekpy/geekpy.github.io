<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.4.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="keywords" content="computer, programming, data science, deep learning">
<meta property="og:type" content="website">
<meta property="og:title" content="Geekpy&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Geekpy&#39;s Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Geekpy&#39;s Blog">



  <link rel="alternate" href="/atom.xml" title="Geekpy's Blog" type="application/atom+xml" />




  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Geekpy's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Geekpy's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/25/python_time2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="geekpy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geekpy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/25/python_time2/" itemprop="url">
                  史上最详解Python日期和时间处理（下）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-08-25 11:52:56" itemprop="dateCreated datePublished" datetime="2018-08-25T11:52:56+08:00">2018-08-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-05 22:28:36" itemprop="dateModified" datetime="2018-10-05T22:28:36+08:00">2018-10-05</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/25/python_time2/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2018/08/25/python_time2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>此下篇主要讲解跟时区相关的概念和程序中经常使用的场景，希望通过此文大家可以搞定所有时区相关的编程问题（如果还有不明白的地方，请联系我，我将进一步补充）。</p>
<p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/25/python_time2/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/12/python_time/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="geekpy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geekpy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/12/python_time/" itemprop="url">
                  史上最详解Python日期和时间处理（上）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-08-12 11:52:56" itemprop="dateCreated datePublished" datetime="2018-08-12T11:52:56+08:00">2018-08-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-05 22:28:49" itemprop="dateModified" datetime="2018-10-05T22:28:49+08:00">2018-10-05</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/12/python_time/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2018/08/12/python_time/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>好吧，我承认这有标题党的嫌疑，不过看了那么多文章，的确没有找到一篇让我满意的关于日期和时间处理的详解文章，于是决心自己动手亲写一篇，希望能对得起这个霸气的标题。言归正传，在Python编程中，日期和时间处理是非常繁琐的一块，不仅概念众多，且有很多不同的module, 尤其涉及时区处理的时候会将问题进一步复杂化。本文将对Python在日期和时间处理上进行一步步详细讲解，总共会分为上下两篇，其中时区处理是较为棘手的一块内容，单独拿出来作为下篇。此上篇将主要讲解时间和日期处理中的基本概念，和常用的场景。</p>
<p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/12/python_time/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/27/Redis数据类型和常用命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="geekpy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geekpy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/27/Redis数据类型和常用命令/" itemprop="url">
                  Redis数据类型和常用命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-27 18:18:18" itemprop="dateCreated datePublished" datetime="2018-07-27T18:18:18+08:00">2018-07-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-05 22:16:23" itemprop="dateModified" datetime="2018-10-05T22:16:23+08:00">2018-10-05</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/27/Redis数据类型和常用命令/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2018/07/27/Redis数据类型和常用命令/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Redis相较于其它的数据库虽然简单，但是要熟记所有命令的用法也并非易事。一个简单的技巧是通过要操作的数据类型来将这些命令进行结构化。</p>
<p>&lt;!--more--&gt;</p>
<h2>数据类型和对应命令</h2>
<p>所有存储于redis中的数据都对应于一个键值对(key-value pair), key可以是任意二进制序列，通常我们使用字符串来标记一个特定的key。在redis中我们通常称这个key为name或者就叫key, 而对于value，redis支持如下几种类型：</p>
<ul>
<li>strings</li>
<li>lists: list内容只能是string</li>
<li>sets: set中存储非重复的string</li>
<li>sorted sets: 与sets类似，但是每个string都会对应一个float类型的score，从而用于排序</li>
<li>hashes: 键值对hash类型，也就是Python中的dict，注意在redis中最外层的key一般叫做name或者key，而value中数据类型如果是dict，那么这个dict中的key通常被称为field。</li>
<li>Bit arrays (or simply bitmaps): 实际存储的仍然是string，但是可以针对bit进行操作</li>
<li>HyperLogLogs: 用于估计unique value的数量</li>
</ul>
<p>针对不同的数据类型，会有不同的命令，通过如下脑图可以更加清晰地记忆redis的命令
<img src="https://upload-images.jianshu.io/upload_images/3959253-6c756bf39ad702c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Redis数据类型与常用命令"></p>
<h4>strings</h4>
<p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">set</span> <span class="selector-tag">strtest</span> <span class="selector-tag">xyz</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">get</span> <span class="selector-tag">strtest</span></span><br><span class="line">"<span class="selector-tag">xyz</span>"</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">mset</span> <span class="selector-tag">a</span> 1 <span class="selector-tag">b</span> 2 <span class="selector-tag">c</span> 3</span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">mget</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">c</span></span><br><span class="line">1) "1"</span><br><span class="line">2) "2"</span><br><span class="line">3) "3"</span><br><span class="line"># 注意以下增减操作只能针对整数数字(虽然类型仍然是<span class="selector-tag">string</span>类型)</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">incr</span> <span class="selector-tag">a</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">incrby</span> <span class="selector-tag">b</span> 5</span><br><span class="line">(<span class="selector-tag">integer</span>) 7</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">decr</span> <span class="selector-tag">b</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 6</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">decrby</span> <span class="selector-tag">b</span> 3</span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br></pre></td></tr></table></figure></p>
<h4>lists</h4>
<p>lists类型中存储的仍然是string类型
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># left push用于从左将item压入到list当中</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpush list_test <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意如果想看list中的内容，无法通过get直接去看，get只是针对string，而必须使用lrange</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get list_test </span><br><span class="line">(<span class="keyword">error</span>) WRONGTYPE Operation against a key holding the wrong kind of value</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里0 -1均为list index，表示从index 0 开始到-1结束，-1即从右数最后一个item</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; <span class="keyword">lrange</span> list_test <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"3"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"2"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"1"</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; rpush list_test <span class="number">5</span> <span class="number">7</span></span><br><span class="line">(integer) <span class="number">5</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; <span class="keyword">lrange</span> list_test <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"3"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"2"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"1"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"5"</span></span><br><span class="line"><span class="number">5</span>) <span class="string">"7"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpop list_test</span><br><span class="line"><span class="string">"3"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; <span class="keyword">lrange</span> list_test <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"2"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"1"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"5"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"7"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从左trim截断list，以下是截取index 0 到index 2 的item作为新的list</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; ltrim list_test <span class="number">0</span> <span class="number">2</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; <span class="keyword">lrange</span> list_test <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"2"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"1"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"5"</span></span><br></pre></td></tr></table></figure></p>
<h4>hashes (dict)</h4>
<p>哈希类型，在python中也就是dict类型。这也是非常常用的数据类型。
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> hset htest a <span class="number">1</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> hget htest a</span><br><span class="line"><span class="string">"1"</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> hmset htest a <span class="number">1</span> b <span class="number">2</span> c <span class="number">3</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> hmget htest a b c</span><br><span class="line"><span class="number">1</span>) <span class="string">"1"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"2"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"3"</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> hgetall htest</span><br><span class="line"><span class="number">1</span>) <span class="string">"a"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"1"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"b"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"2"</span></span><br><span class="line"><span class="number">5</span>) <span class="string">"c"</span></span><br><span class="line"><span class="number">6</span>) <span class="string">"3"</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> hkeys htest</span><br><span class="line"><span class="number">1</span>) <span class="string">"a"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"b"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"c"</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> hvals htest</span><br><span class="line"><span class="number">1</span>) <span class="string">"1"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"2"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"3"</span></span><br></pre></td></tr></table></figure></p>
<p>在python程序中使用redis-py driver的时候，通过dict进行操作会非常清晰和简单。
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">In</span> [<span class="number">1</span>]: import redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> [<span class="number">2</span>]: r = redis.StrictRedis(host=<span class="symbol">'localhost</span>', port=<span class="number">6379</span>, db=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> [<span class="number">3</span>]: d = &#123;<span class="string">"a"</span>: <span class="number">2</span>, <span class="string">"b"</span>: <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> [<span class="number">4</span>]: key = <span class="string">"test:2"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> [<span class="number">5</span>]: r.hmset(key, d)</span><br><span class="line"><span class="keyword">Out</span>[<span class="number">5</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> [<span class="number">6</span>]: r.hgetall(key)</span><br><span class="line"><span class="keyword">Out</span>[<span class="number">6</span>]: &#123;<span class="string">'a'</span>: <span class="string">'2'</span>, <span class="string">'b'</span>: <span class="string">'3'</span>&#125;</span><br></pre></td></tr></table></figure></p>
<h4>sets</h4>
<p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> sadd set_test a b <span class="number">33</span></span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> sadd set_test c a b <span class="number">22</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以看到不会有重复的item</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> smembers set_test</span><br><span class="line"><span class="number">1</span>) <span class="string">"c"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"33"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"a"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"b"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于测试set中是否包含指定的item，如有则返回1，没有返回0</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> sismember set_test a</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> sismember set_test xx</span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> sadd set_test2 a b <span class="number">56</span> <span class="number">66</span></span><br><span class="line">(integer) <span class="number">4</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> smembers set_test2</span><br><span class="line"><span class="number">1</span>) <span class="string">"56"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"a"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"66"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"b"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 求交集</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> sinter set_test set_test2</span><br><span class="line"><span class="number">1</span>) <span class="string">"a"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"b"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 求并集</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> sunion set_test set_test2</span><br><span class="line"><span class="number">1</span>) <span class="string">"33"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"a"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"56"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"c"</span></span><br><span class="line"><span class="number">5</span>) <span class="string">"66"</span></span><br><span class="line"><span class="number">6</span>) <span class="string">"22"</span></span><br><span class="line"><span class="number">7</span>) <span class="string">"b"</span></span><br></pre></td></tr></table></figure></p>
<h4>sorted sets</h4>
<p>sorted sets与sets类似，可以保证item不重复，区别在于sorted sets中每个item对应一个float类型的score
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">zadd</span> <span class="selector-tag">sort_set</span> 2<span class="selector-class">.2</span> <span class="selector-tag">a</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">zadd</span> <span class="selector-tag">sort_set</span> 2 <span class="selector-tag">bb</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">zadd</span> <span class="selector-tag">sort_set</span> 10 <span class="selector-tag">x</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line"></span><br><span class="line"># 获取<span class="selector-tag">index</span> 从0 到<span class="selector-tag">-1</span>的(即所有) <span class="selector-tag">items</span></span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">zrange</span> <span class="selector-tag">sort_set</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) "<span class="selector-tag">bb</span>"</span><br><span class="line">2) "<span class="selector-tag">a</span>"</span><br><span class="line">3) "<span class="selector-tag">x</span>"</span><br><span class="line"></span><br><span class="line"># 获取<span class="selector-tag">item</span> <span class="selector-tag">bb</span>对应的<span class="selector-tag">index</span></span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">zrank</span> <span class="selector-tag">sort_set</span> <span class="selector-tag">bb</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">zrank</span> <span class="selector-tag">sort_set</span> <span class="selector-tag">x</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">zscore</span> <span class="selector-tag">sort_set</span> <span class="selector-tag">x</span></span><br><span class="line">"10"</span><br><span class="line"></span><br><span class="line"># 用于获取对应<span class="selector-tag">score</span> <span class="selector-tag">set</span>中<span class="selector-tag">item</span>的数量</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">zcard</span> <span class="selector-tag">sort_set</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br></pre></td></tr></table></figure></p>
<h4>bit arrays</h4>
<p>用于针对指定的key设置位数据为0 或 1。当我们对存储有较高要求，且对于统计为1的item的数量时，使用bit array是一个好的办法。
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 针对<span class="selector-tag">bit</span> 7进行设置，设置为1，返回该位之前存储的值</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">bit_test</span> 7 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">bit_test</span> 7 0</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">get</span> <span class="selector-tag">bit_test</span></span><br><span class="line">"\<span class="selector-tag">x00</span>"</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">bit_test</span> 8 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">bit_test</span> 9 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line"></span><br><span class="line"># 统计有多少位为1</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">bitcount</span> <span class="selector-tag">bit_test</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br></pre></td></tr></table></figure></p>
<h4>HyperLogLogs</h4>
<p>redis实现了相应算法可以估计hyperloglog中存储的所有item中非重复的item的数量
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">pfadd</span> <span class="selector-tag">loglog</span> 1 3 5 7 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">pfcount</span> <span class="selector-tag">loglog</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br></pre></td></tr></table></figure></p>
<h2>通用的命令</h2>
<ul>
<li>keys pattern: pattern可以为glob风格的通配符格式，最常用的是<code>keys *</code>查询所有的keys</li>
<li>exists key: 查询该key是否存在</li>
<li>del key: 删除该key对应的数据</li>
<li>type key: 查询该key对应的value的数据类型</li>
<li>expire key: 定义多长时间后key对应的数据过期，过期后数据会被自动删除</li>
<li>ttl key: 查询该key对应的剩余存活时间</li>
<li>flushdb/flushall: flushdb用于清除当前db的所有数据，flushall清除所有数据库的数据</li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://redis.io/topics/data-types-intro" target="_blank" rel="noopener">Redis Type Introduction</a></li>
<li><a href="https://redis.io/commands#" target="_blank" rel="noopener">Redis Commands</a></li>
<li><a href="https://segmentfault.com/a/1190000010999677" target="_blank" rel="noopener">Redis 常用命令</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/23/Pandas系列6-DataFrame的分组与聚合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="geekpy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geekpy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/23/Pandas系列6-DataFrame的分组与聚合/" itemprop="url">
                  Pandas系列6-DataFrame的分组与聚合
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-23 18:18:18" itemprop="dateCreated datePublished" datetime="2018-07-23T18:18:18+08:00">2018-07-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-08-12 18:06:16" itemprop="dateModified" datetime="2018-08-12T18:06:16+08:00">2018-08-12</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/23/Pandas系列6-DataFrame的分组与聚合/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2018/07/23/Pandas系列6-DataFrame的分组与聚合/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在对数据进行处理的时候，分组与聚合是非常常用的操作。在Pandas中此类操作主要是通过groupby函数来完成的。</p>
<p>&lt;!--more--&gt;</p>
<p>先看一个实际的例子：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># 生成一个原始的DataFrame</span><br><span class="line">In [70]: raw_data = &#123;&apos;regiment&apos;: [&apos;Nighthawks&apos;, &apos;Nighthawks&apos;, &apos;Nighthawks&apos;, &apos;Nighthawk</span><br><span class="line">    ...: s&apos;, &apos;Dragoons&apos;, &apos;Dragoons&apos;, &apos;Dragoons&apos;, &apos;Dragoons&apos;, &apos;Scouts&apos;, &apos;Scouts&apos;, &apos;Scou</span><br><span class="line">    ...: ts&apos;, &apos;Scouts&apos;],</span><br><span class="line">    ...:         &apos;company&apos;: [&apos;1st&apos;, &apos;1st&apos;, &apos;2nd&apos;, &apos;2nd&apos;, &apos;1st&apos;, &apos;1st&apos;, &apos;2nd&apos;, &apos;2nd&apos;,&apos;1</span><br><span class="line">    ...: st&apos;, &apos;1st&apos;, &apos;2nd&apos;, &apos;2nd&apos;],</span><br><span class="line">    ...:         &apos;name&apos;: [&apos;Miller&apos;, &apos;Jacobson&apos;, &apos;Ali&apos;, &apos;Milner&apos;, &apos;Cooze&apos;, &apos;Jacon&apos;, &apos;Ry</span><br><span class="line">    ...: aner&apos;, &apos;Sone&apos;, &apos;Sloan&apos;, &apos;Piger&apos;, &apos;Riani&apos;, &apos;Ali&apos;],</span><br><span class="line">    ...:         &apos;preTestScore&apos;: [4, 24, 31, 2, 3, 4, 24, 31, 2, 3, 2, 3],</span><br><span class="line">    ...:         &apos;postTestScore&apos;: [25, 94, 57, 62, 70, 25, 94, 57, 62, 70, 62, 70]&#125;</span><br><span class="line">    ...:</span><br><span class="line"></span><br><span class="line">In [71]: df = pd.DataFrame(raw_data, columns = [&apos;regiment&apos;, &apos;company&apos;, &apos;name&apos;, &apos;preTes</span><br><span class="line">    ...: tScore&apos;, &apos;postTestScore&apos;])</span><br><span class="line"></span><br><span class="line">In [72]: df</span><br><span class="line">Out[72]:</span><br><span class="line">      regiment company      name  preTestScore  postTestScore</span><br><span class="line">0   Nighthawks     1st    Miller             4             25</span><br><span class="line">1   Nighthawks     1st  Jacobson            24             94</span><br><span class="line">2   Nighthawks     2nd       Ali            31             57</span><br><span class="line">3   Nighthawks     2nd    Milner             2             62</span><br><span class="line">4     Dragoons     1st     Cooze             3             70</span><br><span class="line">5     Dragoons     1st     Jacon             4             25</span><br><span class="line">6     Dragoons     2nd    Ryaner            24             94</span><br><span class="line">7     Dragoons     2nd      Sone            31             57</span><br><span class="line">8       Scouts     1st     Sloan             2             62</span><br><span class="line">9       Scouts     1st     Piger             3             70</span><br><span class="line">10      Scouts     2nd     Riani             2             62</span><br><span class="line">11      Scouts     2nd       Ali             3             70</span><br></pre></td></tr></table></figure></p>
<p>通过groupby函数生成一个groupby对象，如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 当针对特定列（此例是&apos;preTestScore&apos;）进行分组时，需要通过df[&apos;colume_name&apos;](此例是df[&apos;regiment&apos;])来指定键名</span><br><span class="line">In [73]: groupby_regiment = df[&apos;preTestScore&apos;].groupby(df[&apos;regiment&apos;])</span><br><span class="line"></span><br><span class="line"># 生成的groupby对象没有做任何计算，只是将数据按键进行分组</span><br><span class="line">In [74]: groupby_regiment</span><br><span class="line">Out[74]: &lt;pandas.core.groupby.SeriesGroupBy object at 0x11112cef0&gt;</span><br><span class="line"></span><br><span class="line"># 分组的聚合统计</span><br><span class="line">In [75]: groupby_regiment.describe()</span><br><span class="line">Out[75]:</span><br><span class="line">            count   mean        std  min   25%   50%    75%   max</span><br><span class="line">regiment</span><br><span class="line">Dragoons      4.0  15.50  14.153916  3.0  3.75  14.0  25.75  31.0</span><br><span class="line">Nighthawks    4.0  15.25  14.453950  2.0  3.50  14.0  25.75  31.0</span><br><span class="line">Scouts        4.0   2.50   0.577350  2.0  2.00   2.5   3.00   3.0</span><br><span class="line"></span><br><span class="line"># 也可以针对特定统计单独计算</span><br><span class="line">In [76]: groupby_regiment.mean()</span><br><span class="line">Out[76]:</span><br><span class="line">regiment</span><br><span class="line">Dragoons      15.50</span><br><span class="line">Nighthawks    15.25</span><br><span class="line">Scouts         2.50</span><br><span class="line">Name: preTestScore, dtype: float64</span><br></pre></td></tr></table></figure></p>
<p>整个分组统计的过程，可以通过下图更清晰地展示：
<img src="https://upload-images.jianshu.io/upload_images/3959253-c268458a8035803b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.1-group and aggregate process"></p>
<h4>聚合函数</h4>
<p>聚合的时候，既可以使用Pandas内置的函数进行聚合计算，也可以使用自定义的函数进行聚合计算，我们先来看下内置的函数：
<img src="https://upload-images.jianshu.io/upload_images/3959253-0b1bee24d432dc9c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.2-built-in aggregate functions">
另外，我们也可以自定义聚合函数：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [81]: def my_agg(pre_test_score_group):</span><br><span class="line">    ...:     return np.sum(np.power(pre_test_score_group, 2))</span><br><span class="line">    ...:</span><br><span class="line"></span><br><span class="line">In [82]: df[&apos;preTestScore&apos;].groupby(df[&apos;regiment&apos;]).apply(my_agg)</span><br><span class="line">Out[82]:</span><br><span class="line">regiment</span><br><span class="line">Dragoons      1562</span><br><span class="line">Nighthawks    1557</span><br><span class="line">Scouts          26</span><br><span class="line">Name: preTestScore, dtype: int64</span><br></pre></td></tr></table></figure></p>
<p>通过上面的例子我们可以看到，通过apply函数也可以完成类似for循环的迭代，在pandas中尽可能使用apply函数来代替for循环迭代，以提高性能。</p>
<h4>根据多个键进行分组和聚合</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 如果有多个键，将多个键放到一个list当中，作为groupby的参数</span><br><span class="line">In [77]: df[&apos;preTestScore&apos;].groupby([df[&apos;regiment&apos;], df[&apos;company&apos;]]).mean()</span><br><span class="line">Out[77]:</span><br><span class="line">regiment    company</span><br><span class="line">Dragoons    1st         3.5</span><br><span class="line">            2nd        27.5</span><br><span class="line">Nighthawks  1st        14.0</span><br><span class="line">            2nd        16.5</span><br><span class="line">Scouts      1st         2.5</span><br><span class="line">            2nd         2.5</span><br><span class="line">Name: preTestScore, dtype: float64</span><br><span class="line"></span><br><span class="line"># unstack之后变成表格模式，更加清晰</span><br><span class="line">In [78]: df[&apos;preTestScore&apos;].groupby([df[&apos;regiment&apos;], df[&apos;company&apos;]]).mean().unstack()</span><br><span class="line">Out[78]:</span><br><span class="line">company      1st   2nd</span><br><span class="line">regiment</span><br><span class="line">Dragoons     3.5  27.5</span><br><span class="line">Nighthawks  14.0  16.5</span><br><span class="line">Scouts       2.5   2.5</span><br></pre></td></tr></table></figure></p>
<h2>References</h2>
<ul>
<li><a href="https://chrisalbon.com/python/data_wrangling/pandas_apply_operations_to_groups/" target="_blank" rel="noopener">Apply Operations To Groups In Pandas</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/version/0.23/generated/pandas.DataFrame.groupby.html" target="_blank" rel="noopener">Pandas official doc - groupby </a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/06/Pandas系列5-DataFrame之过滤/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="geekpy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geekpy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/06/Pandas系列5-DataFrame之过滤/" itemprop="url">
                  Pandas系列5-DataFrame之过滤
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-06 18:18:18" itemprop="dateCreated datePublished" datetime="2018-07-06T18:18:18+08:00">2018-07-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-08-12 18:06:03" itemprop="dateModified" datetime="2018-08-12T18:06:03+08:00">2018-08-12</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/06/Pandas系列5-DataFrame之过滤/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2018/07/06/Pandas系列5-DataFrame之过滤/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Pandas的条件过滤是使用非常频繁的技巧，在这一节我们将看到各种不同的过滤技巧，如果读者有其它过滤技巧，也欢迎告诉我。</p>
<p>&lt;!--more--&gt;</p>
<h2>条件过滤与赋值</h2>
<p>通过loc进行行过滤，并对过滤后的行进行赋值
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">In [34]: df</span><br><span class="line">Out[34]:</span><br><span class="line">   age  color  height</span><br><span class="line">0   20   blue     165</span><br><span class="line">1   30    red     175</span><br><span class="line">2   15  green     185</span><br><span class="line"></span><br><span class="line"># 注意这里赋值需要使用如下方式，而不能使用chained index</span><br><span class="line"># 具体参考http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy</span><br><span class="line">In [38]: df.loc[df.color == &apos;blue&apos;,&apos;height&apos;] = 199</span><br><span class="line"></span><br><span class="line">In [39]: df</span><br><span class="line">Out[39]:</span><br><span class="line">   age  color  height</span><br><span class="line">0   20   blue     199</span><br><span class="line">1   30    red     175</span><br><span class="line">2   15  green     185</span><br><span class="line"></span><br><span class="line"># 表示列数据除了上例中使用&apos;.&apos;,还可以使用&apos;[]&apos;,如下:</span><br><span class="line">In [40]: df.loc[df2[&apos;color&apos;]==&apos;blue&apos;, &apos;height&apos;] = 175</span><br><span class="line"></span><br><span class="line">In [41]: df</span><br><span class="line">Out[41]:</span><br><span class="line">   age  color  height</span><br><span class="line">0   20   blue     175</span><br><span class="line">1   30    red     175</span><br><span class="line">2   15  green     185</span><br></pre></td></tr></table></figure></p>
<p>除了上述的过滤方式外，还可以通过query method来进行过滤查询，如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [248]: df2</span><br><span class="line">Out[248]:</span><br><span class="line">   age  color  height</span><br><span class="line">0   20  black     155</span><br><span class="line">1   33  green     177</span><br><span class="line">2   22    NaN     188</span><br><span class="line">3   20   blue     175</span><br><span class="line"></span><br><span class="line">In [250]: df2.query(&apos;age&gt;20 &amp; age&lt;40&apos;)</span><br><span class="line">Out[250]:</span><br><span class="line">   age  color  height</span><br><span class="line">1   33  green     177</span><br><span class="line">2   22    NaN     188</span><br></pre></td></tr></table></figure></p>
<h2>空值判断</h2>
<p>在数据处理的过程中，空值判断是非常常用的技巧，在Pandas中我们主要通过以下几种方式来判断空值。</p>
<ul>
<li>isnull函数: 用于针对Series、DataFrame判断是否为null</li>
<li>notnull函数: 用于判断非null值</li>
<li>np.isnan函数: 用于针对某个标量值进行判断是否为nan(null)。需要注意的是这个函数不能用于字符串类型的值进行判断，因此如果array中有字符串类型，需要用其它方式进行判断，如isinstance</li>
</ul>
<h5>isnull函数</h5>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">In [605]: dfx</span><br><span class="line">Out[605]:</span><br><span class="line">    1  2</span><br><span class="line">0</span><br><span class="line">a1  2  4</span><br><span class="line">a2  5  5</span><br><span class="line">b1  5  7</span><br><span class="line"></span><br><span class="line">In [606]: dfx.iloc[1, 1] = np.nan</span><br><span class="line"></span><br><span class="line">In [607]: dfx</span><br><span class="line">Out[607]:</span><br><span class="line">    1    2</span><br><span class="line">0</span><br><span class="line">a1  2  4.0</span><br><span class="line">a2  5  NaN</span><br><span class="line">b1  5  7.0</span><br><span class="line"></span><br><span class="line">In [608]: dfx.isnull()</span><br><span class="line">Out[608]:</span><br><span class="line">        1      2</span><br><span class="line">0</span><br><span class="line">a1  False  False</span><br><span class="line">a2  False   True</span><br><span class="line">b1  False  False</span><br><span class="line"></span><br><span class="line"># 如果该列所有的值均不为null则返回False，只要有一个值为null则返回True</span><br><span class="line">In [609]: dfx.isnull().any()</span><br><span class="line">Out[609]:</span><br><span class="line">1    False</span><br><span class="line">2     True</span><br><span class="line">dtype: bool</span><br><span class="line"></span><br><span class="line"># 针对DataFrame中的所有值进行检查，只要有一个null值，则返回True</span><br><span class="line">In [610]: dfx.isnull().any().any()</span><br><span class="line">Out[610]: True</span><br><span class="line"></span><br><span class="line"># 返回null值的数量</span><br><span class="line">In [611]: dfx.isnull().sum().sum()</span><br><span class="line">Out[611]: 1</span><br></pre></td></tr></table></figure></p>
<p>将isnull用于过滤条件：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [244]: df2</span><br><span class="line">Out[244]:</span><br><span class="line">   age  color  height</span><br><span class="line">0   20  black     155</span><br><span class="line">1   33  green     177</span><br><span class="line">2   22    NaN     188</span><br><span class="line">3   20   blue     165</span><br><span class="line"></span><br><span class="line">In [245]: df2.loc[df2[&apos;color&apos;].isnull(), :]</span><br><span class="line">Out[245]:</span><br><span class="line">   age color  height</span><br><span class="line">2   22   NaN     188</span><br></pre></td></tr></table></figure></p>
<h5>notnull函数</h5>
<p>notnull的使用与isnull类似,如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [248]: df2</span><br><span class="line">Out[248]:</span><br><span class="line">   age  color  height</span><br><span class="line">0   20  black     155</span><br><span class="line">1   33  green     177</span><br><span class="line">2   22    NaN     188</span><br><span class="line">3   20   blue     175</span><br><span class="line"></span><br><span class="line">In [249]: df2.loc[df2.color.notnull(), :]</span><br><span class="line">Out[249]:</span><br><span class="line">   age  color  height</span><br><span class="line">0   20  black     155</span><br><span class="line">1   33  green     177</span><br><span class="line">3   20   blue     175</span><br></pre></td></tr></table></figure></p>
<h5>np.isnan函数</h5>
<p>需要注意的是判断dataframe中某个值是否为空，不能直接用== np.nan来判断，而需要使用np.isnan函数如下
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [616]: dfx.iloc[1, 1] == np.nan</span><br><span class="line">Out[616]: False</span><br><span class="line"></span><br><span class="line">In [614]: np.isnan(dfx.iloc[1, 1])</span><br><span class="line">Out[614]: True</span><br><span class="line"></span><br><span class="line"># 其它判断方式同样不行</span><br><span class="line">In [617]: dfx.iloc[1, 1] is None</span><br><span class="line">Out[617]: False</span><br><span class="line"></span><br><span class="line">In [618]: if not dfx.iloc[1, 1]: print(&quot;True&quot;)</span><br><span class="line"></span><br><span class="line">In [619]:</span><br></pre></td></tr></table></figure></p>
<h2>isin函数</h2>
<p>使用isin函数
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">In [764]: df</span><br><span class="line">Out[764]:</span><br><span class="line">           age  color    food  height  score state</span><br><span class="line">Jane        30   blue   Steak     178    4.6    NY</span><br><span class="line">Nick         2  green    Lamb     181    8.3    TX</span><br><span class="line">Aaron       12    red   Mango     178    9.0    FL</span><br><span class="line">Penelope     4  white   Apple     178    3.3    AL</span><br><span class="line">Dean        32   gray  Cheese     175    1.8    AK</span><br><span class="line">Christina   33  black   Melon     178    9.5    TX</span><br><span class="line">Cornelia    69    red   Beans     178    2.2    TX</span><br><span class="line"></span><br><span class="line">In [765]: df3 = df[df[&apos;state&apos;].isin([&apos;NY&apos;, &apos;TX&apos;])]</span><br><span class="line"></span><br><span class="line">In [766]: df3</span><br><span class="line">Out[766]:</span><br><span class="line">           age  color   food  height  score state</span><br><span class="line">Jane        30   blue  Steak     178    4.6    NY</span><br><span class="line">Nick         2  green   Lamb     181    8.3    TX</span><br><span class="line">Christina   33  black  Melon     178    9.5    TX</span><br><span class="line">Cornelia    69    red  Beans     178    2.2    TX</span><br><span class="line"></span><br><span class="line"># 也可以使用&apos;~&apos;或者&apos;-&apos;来选择不在列表中的项</span><br><span class="line">In [773]: df3 = df[-df[&apos;state&apos;].isin([&apos;NY&apos;, &apos;TX&apos;])]</span><br><span class="line"></span><br><span class="line">In [774]: df3</span><br><span class="line">Out[774]:</span><br><span class="line">          age  color    food  height  score state</span><br><span class="line">Aaron      12    red   Mango     178    9.0    FL</span><br><span class="line">Penelope    4  white   Apple     178    3.3    AL</span><br><span class="line">Dean       32   gray  Cheese     175    1.8    AK</span><br></pre></td></tr></table></figure></p>
<h2>多过滤条件</h2>
<p>当有多个过滤条件时，我们就需要使用逻辑操作符<code>&amp;</code>, <code>|</code>,如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [251]: df2</span><br><span class="line">Out[251]:</span><br><span class="line">   age  color  height</span><br><span class="line">0   20  black     155</span><br><span class="line">1   33  green     177</span><br><span class="line">2   22    NaN     188</span><br><span class="line">3   20   blue     175</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [254]: df2.loc[(df2.age&gt;20) &amp; (df2.color.notnull())]</span><br><span class="line">Out[254]:</span><br><span class="line">   age  color  height</span><br><span class="line">1   33  green     177</span><br><span class="line"></span><br><span class="line"># 注意在逻辑操作符两边的过滤条件必须使用小括号括起来，否则条件过滤不起作用，如下：</span><br><span class="line">In [253]: df2.loc[df2.age&gt;20 &amp; df2.color.notnull()]</span><br><span class="line">Out[253]:</span><br><span class="line">   age  color  height</span><br><span class="line">0   20  black     155</span><br><span class="line">1   33  green     177</span><br><span class="line">2   22    NaN     188</span><br><span class="line">3   20   blue     175</span><br></pre></td></tr></table></figure></p>
<h2>过滤后的赋值计算</h2>
<p>在实际项目中，很多时候我们根据条件选取了一些行之后，我们要针对这些行中的数据需要做些操作（比如针对age进行加1操作），更复杂的我们需要获取本行的其它列的数据共同计算和判断。这里我们可以使用如下技巧:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">In [256]: df</span><br><span class="line">Out[256]:</span><br><span class="line">           age  color    food  height  score state</span><br><span class="line">Jane        30   blue   Steak     165    4.6    NY</span><br><span class="line">Nick         2  green    Lamb      70    8.3    TX</span><br><span class="line">Aaron       12    red   Mango     120    9.0    FL</span><br><span class="line">Penelope     4  white   Apple      80    3.3    AL</span><br><span class="line">Dean        32   gray  Cheese     180    1.8    AK</span><br><span class="line">Christina   33  black   Melon     172    9.5    TX</span><br><span class="line">Cornelia    69    red   Beans     150    2.2    TX</span><br><span class="line"></span><br><span class="line"># 使用mask作为我们的筛选条件</span><br><span class="line">In [258]: mask = (df.color==&apos;blue&apos;)</span><br><span class="line"></span><br><span class="line"># 选出符合条件的行，并对age列的数据进行加1操作</span><br><span class="line">In [260]: df.loc[mask, &apos;age&apos;] = df.loc[mask, &apos;age&apos;] + 1</span><br><span class="line"></span><br><span class="line">In [261]: df</span><br><span class="line">Out[261]:</span><br><span class="line">           age  color    food  height  score state</span><br><span class="line">Jane        31   blue   Steak     165    4.6    NY</span><br><span class="line">Nick         2  green    Lamb      70    8.3    TX</span><br><span class="line">Aaron       12    red   Mango     120    9.0    FL</span><br><span class="line">Penelope     4  white   Apple      80    3.3    AL</span><br><span class="line">Dean        32   gray  Cheese     180    1.8    AK</span><br><span class="line">Christina   33  black   Melon     172    9.5    TX</span><br><span class="line">Cornelia    69    red   Beans     150    2.2    TX</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 更复杂的，我们如果需要同一行的其它数据进行计算，那么我们就需要使用apply函数和并选出响应的列，如下:</span><br><span class="line">In [262]: df_with_age_height = df.loc[mask, [&apos;age&apos;, &apos;height&apos;]]</span><br><span class="line"></span><br><span class="line">In [265]: df.loc[mask, &apos;score&apos;] = df_with_age_height.apply(lambda row: row[&apos;age&apos;] + row[&apos;</span><br><span class="line">     ...: height&apos;]/100, axis=1)</span><br><span class="line"></span><br><span class="line">In [266]: df</span><br><span class="line">Out[266]:</span><br><span class="line">           age  color    food  height  score state</span><br><span class="line">Jane        31   blue   Steak     165  32.65    NY</span><br><span class="line">Nick         2  green    Lamb      70   8.30    TX</span><br><span class="line">Aaron       12    red   Mango     120   9.00    FL</span><br><span class="line">Penelope     4  white   Apple      80   3.30    AL</span><br><span class="line">Dean        32   gray  Cheese     180   1.80    AK</span><br><span class="line">Christina   33  black   Melon     172   9.50    TX</span><br><span class="line">Cornelia    69    red   Beans     150   2.20    TX</span><br><span class="line"></span><br><span class="line"># 使用apply仍然是使用迭代的方式，我们可以通过vectorization的方式直接计算，如下</span><br><span class="line">In [10]: mask = (df.color == &apos;red&apos;)</span><br><span class="line">In [13]: df_with_age_height = df.loc[mask, [&apos;age&apos;, &apos;height&apos;]]</span><br><span class="line">In [14]: df.loc[mask, &apos;score&apos;] = (df_with_age_height[&apos;age&apos;] + df_with_age_height[&apos;height&apos;])/100</span><br><span class="line"></span><br><span class="line">In [15]: df</span><br><span class="line">Out[15]:</span><br><span class="line">           age  color    food  height  score state</span><br><span class="line">Jane        30   blue   Steak     165   1.95    NY</span><br><span class="line">Nick         2  green    Lamb      70   8.30    TX</span><br><span class="line">Aaron       12    red   Mango     120   1.32    FL</span><br><span class="line">Penelope     4  white   Apple      80   3.30    AL</span><br><span class="line">Dean        32   gray  Cheese     180   1.80    AK</span><br><span class="line">Christina   33  black   Melon     172   9.50    TX</span><br><span class="line">Cornelia    69    red   Beans     150   2.19    TX</span><br></pre></td></tr></table></figure></p>
<p>关于vectorization矢量化的相关议题，可以参考文章<a href="https://www.jianshu.com/p/4855c24579b8" target="_blank" rel="noopener">Pandas系列4-数据矢量化</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/21/Python定时任务-schedule-vs--Celery-vs--APScheduler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="geekpy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geekpy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/21/Python定时任务-schedule-vs--Celery-vs--APScheduler/" itemprop="url">
                  Python定时任务-schedule vs. Celery vs. APScheduler
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-21 18:18:18" itemprop="dateCreated datePublished" datetime="2018-06-21T18:18:18+08:00">2018-06-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-08-12 18:06:55" itemprop="dateModified" datetime="2018-08-12T18:06:55+08:00">2018-08-12</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/21/Python定时任务-schedule-vs--Celery-vs--APScheduler/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2018/06/21/Python定时任务-schedule-vs--Celery-vs--APScheduler/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文详细讲述了在Python开发中常用的几种定时任务途径，并重点对比了schedule, Celery和APScheduler</p>
<p>&lt;!--more--&gt;</p>
<p>在Python开发过程中我们经常需要执行定时任务，而此类任务我们通常有如下选项：</p>
<ul>
<li>自己造轮子</li>
<li>使用schedule库</li>
<li>使用Celery定时任务</li>
<li>使用APScheduler</li>
</ul>
<p>自己造轮子实现，最大的优势就是灵活性，调试方便，对于某些特定系统也许也是一种选择，不过对于大多数应用来说，我们应当尽可能地使用开源的成熟的方案。下面对后三种方案分别讨论：</p>
<h2>使用schedule库</h2>
<p>schedule库是一个轻量级的定时任务方案，<strong>优势是使用简单，也不需要做什么配置；缺点是无法动态添加任务，也无法将任务持久化。</strong></p>
<h5>安装</h5>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install schedule</span><br></pre></td></tr></table></figure></p>
<h5>使用</h5>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import schedule</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def job():</span><br><span class="line">    print(&quot;I&apos;m working...&quot;)</span><br><span class="line"></span><br><span class="line">schedule.every(10).minutes.do(job)</span><br><span class="line">schedule.every().hour.do(job)</span><br><span class="line">schedule.every().day.at(&quot;10:30&quot;).do(job)</span><br><span class="line">schedule.every(5).to(10).minutes.do(job)</span><br><span class="line">schedule.every().monday.do(job)</span><br><span class="line">schedule.every().wednesday.at(&quot;13:15&quot;).do(job)</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    schedule.run_pending()</span><br><span class="line">    time.sleep(1)</span><br></pre></td></tr></table></figure></p>
<h2>使用Celery</h2>
<p>Celery在Python领域可谓大名鼎鼎，我们通常将Celery作为一个任务队列来使用，不过Celery也同时提供了定时任务功能。通常，当我们的解决方案中已经在使用Celery的时候可以考虑同时使用其定时任务功能，但是Celery无法在Flask这样的系统中动态添加定时任务（在Django中有相应的插件可以实现动态添加任务），而且如果对于不使用Celery的项目，单独为定时任务搭建Celery显得过于重量级了。(搭建Celery比较麻烦，还需要配置诸如RabbitMQ之类消息分发程序)。</p>
<p>Celery安装在此不再赘述，大家可以参考官网的资料</p>
<h5>使用</h5>
<p>Celery虽然无法动态添加定时任务，但是可以在程序固定位置添加定时任务，如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from celery import Celery</span><br><span class="line">from celery.schedules import crontab</span><br><span class="line"></span><br><span class="line">app = Celery()</span><br><span class="line"></span><br><span class="line"># 此处on_after_configure装饰符意味着当Celery app配置完成之后调用该hook函数</span><br><span class="line">@app.on_after_configure.connect</span><br><span class="line">def setup_periodic_tasks(sender, **kwargs):</span><br><span class="line">    # Calls test(&apos;hello&apos;) every 10 seconds.</span><br><span class="line">    sender.add_periodic_task(10.0, test.s(&apos;hello&apos;), name=&apos;add every 10&apos;)</span><br><span class="line"></span><br><span class="line">    # Calls test(&apos;world&apos;) every 30 seconds</span><br><span class="line">    sender.add_periodic_task(30.0, test.s(&apos;world&apos;), expires=10)</span><br><span class="line"></span><br><span class="line">    # Executes every Monday morning at 7:30 a.m.</span><br><span class="line">    sender.add_periodic_task(</span><br><span class="line">        crontab(hour=7, minute=30, day_of_week=1),</span><br><span class="line">        test.s(&apos;Happy Mondays!&apos;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">@app.task</span><br><span class="line">def test(arg):</span><br><span class="line">    print(arg)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>
<p>这里调用<code>add_periodic_task</code>用于添加一个定时任务，相当于在Celery config文件中的beat_schedule设置项中添加了一项，如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.conf.beat_schedule = &#123;</span><br><span class="line">    &apos;add-every-30-seconds&apos;: &#123;</span><br><span class="line">        &apos;task&apos;: &apos;tasks.add&apos;,</span><br><span class="line">        &apos;schedule&apos;: 30.0,</span><br><span class="line">        &apos;args&apos;: (16, 16)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>在<code>add_periodic_task</code>中指定job function时需要用<code>.s()</code>来调用</p>
</li>
</ul>
<h2>使用APScheduler</h2>
<p>笔者认为APScheduler是在实际项目最好用的一个工具库。<strong>它不仅可以让我们在程序中动态添加和删除我们的定时任务，还支持持久化，且其持久化方案支持很多形式，包括(Memory, MongoDB, SQLAlchemy, Redis, RethinkDB, ZooKeeper), 也可以非常好与一些Python framework集成(包括asyncio, gevent, Tornado, Twisted, Qt).</strong> 笔者所在的项目使用的是Flask框架，也有相应的插件可以供我们直接使用。</p>
<p>但是笔者没有使用插件，而是直接将APScheduler集成于项目代码中。</p>
<h5>初始化scheduler</h5>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 可以在初始化Flask的时候调用，并将返回的scheduler赋给app</span><br><span class="line">def init_scheduler():</span><br><span class="line">    # 这里用于持久化的设置，代码中演示使用MongoDB</span><br><span class="line">    # client用于设置你自己的MongoDB的handler, 即MongoClient对象</span><br><span class="line">    jobstores = &#123;</span><br><span class="line">        &apos;default&apos;: MongoDBJobStore(client=your_db_handler, collection=&quot;schedule_job&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    executors = &#123;</span><br><span class="line">        &apos;default&apos;: ThreadPoolExecutor(20)</span><br><span class="line">    &#125;</span><br><span class="line">    job_defaults = &#123;</span><br><span class="line">        &apos;coalesce&apos;: False,</span><br><span class="line">        &apos;max_instances&apos;: 5</span><br><span class="line">    &#125;</span><br><span class="line">    # 这里使用BackgroundScheduler即可</span><br><span class="line">    scheduler = BackgroundScheduler(jobstores=jobstores, executors=executors, job_defaults=job_defaults, timezone=utc)</span><br><span class="line">    # 注意这里一定要调用start启动scheduler</span><br><span class="line">    scheduler.start()</span><br><span class="line">    return scheduler</span><br></pre></td></tr></table></figure></p>
<h5>添加定时任务</h5>
<p>APScheduler将定时任务分为三种：</p>
<ul>
<li>interval: 比如每隔5分钟执行一次任务</li>
<li>cron: 比如每天早上5点执行一次任务</li>
<li>date: 比如在2018年5月5日执行一次任务</li>
</ul>
<p>我们以添加cron job为例：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def test_job(name):</span><br><span class="line">    print &quot;hello, %s&quot; % name</span><br><span class="line">    </span><br><span class="line">def add_daily_job(name):</span><br><span class="line">    exec_time = datetime.now() + timedelta(minutes=2)</span><br><span class="line">    hour = exec_time.strftime(&quot;%H&quot;)</span><br><span class="line">    minute = exec_time.strftime(&quot;%M&quot;)</span><br><span class="line">    # 这里要选择&apos;cron&apos;</span><br><span class="line">    # 另外，job_id可以根据你自己的情况设定，其会被用于remove_job</span><br><span class="line">    current_app.scheduler.add_job(</span><br><span class="line">        test_job, &apos;cron&apos;, hour=hour, minute=minute,</span><br><span class="line">        args=[name], id=job_id)</span><br></pre></td></tr></table></figure></p>
<h5>删除定时任务</h5>
<p>通过在add_job时使用的job_id可以删除对应的定时任务。实际上在我们添加任务的时候，APScheduler会把相应的任务信息存储于我们jobstore中设置的持久化存储方案，这里使用的是MongoDB，然后当删除的时候会将相应的任务从MongoDB中删除。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def remove_daily_job(job_id):</span><br><span class="line">    current_app.scheduler.remove_job(job_id)</span><br></pre></td></tr></table></figure></p>
<h2>总结：</h2>
<p>APScheduler在实际使用过程中拥有最大的灵活性，可以满足我们的大部分定时任务的相关需求；Celery比较重量级，通常如果项目中已有Celery在使用，而且不需要动态添加定时任务时可以考虑使用；schedule非常轻量级，使用简单，但是不支持任务的持久化，也无法动态添加删除任务，所以主要用于简单的小型应用。</p>
<h2>References</h2>
<ul>
<li><a href="https://github.com/dbader/schedule" target="_blank" rel="noopener">Schedule</a></li>
<li><a href="http://www.celeryproject.org/" target="_blank" rel="noopener">Celery</a></li>
<li><a href="https://apscheduler.readthedocs.io/en/latest/" target="_blank" rel="noopener">APScheduler</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/21/Pandas系列4-数据矢量化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="geekpy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geekpy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/21/Pandas系列4-数据矢量化/" itemprop="url">
                  Pandas系列4-数据矢量化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-21 18:18:18" itemprop="dateCreated datePublished" datetime="2018-06-21T18:18:18+08:00">2018-06-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-08-12 18:05:50" itemprop="dateModified" datetime="2018-08-12T18:05:50+08:00">2018-08-12</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/21/Pandas系列4-数据矢量化/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2018/06/21/Pandas系列4-数据矢量化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们在处理数据问题时，经常会遇到的问题是要将原有数据进行转化，比如在原有
数据的基础上+1操作，或者将原有数据的字符串全部转化为小写字符，更复杂的是
要将原有数据的一部分提取出来使用。这些问题都是数据转化问题，即原有的数据
不能直接使用，而要进一步转化后才能使用。</p>
<p>&lt;!--more--&gt;</p>
<h2>问题</h2>
<p>我们在处理数据问题时，经常会遇到的问题是要将原有数据进行转化，比如在原有数据的基础上+1操作，或者将原有数据的字符串全部转化为小写字符，更复杂的是要将原有数据的一部分提取出来使用。这些问题都是数据转化问题，即原有的数据不能直接使用，而要进一步转化后才能使用。</p>
<h2>示例</h2>
<p>这里举一个笔者在实际项目中遇到的例子来说明。</p>
<p>笔者项目中需要收集的app version信息，原始信息如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [167]: df</span><br><span class="line">Out[167]:</span><br><span class="line">        app_version  uid</span><br><span class="line">0  7.23.1-180522122    1</span><br><span class="line">1  7.20.1-180502135    2</span><br><span class="line">2  7.23.1-180522122    3</span><br><span class="line">3  7.23.1-180522122    4</span><br><span class="line">4  7.16.7-180411077    5</span><br></pre></td></tr></table></figure></p>
<p>但是实际上，我们只需要&quot;-&quot;之前的版本号，而且后续比较的时候要用'-'之前的数字进行比较，因此这样就涉及到了将原版本数据进行转化，即只提取'-'之前的数字，而舍弃后边的数字。</p>
<h4>迭代</h4>
<p>一个显而易见的做法是通过遍历的方式来逐行修改，如下图所示：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [178]: %%timeit</span><br><span class="line">     ...: for index, row in df.iterrows():</span><br><span class="line">     ...:     df.iloc[index, 0] = row[&apos;app_version&apos;].split(&apos;-&apos;)[0]</span><br><span class="line">     ...:</span><br><span class="line">2.34 ms ± 47.4 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</span><br><span class="line"></span><br><span class="line">In [179]: df</span><br><span class="line">Out[179]:</span><br><span class="line">  app_version  uid</span><br><span class="line">0      7.23.1    1</span><br><span class="line">1      7.20.1    2</span><br><span class="line">2      7.23.1    3</span><br><span class="line">3      7.23.1    4</span><br><span class="line">4      7.16.7    5</span><br></pre></td></tr></table></figure></p>
<p>再进一步，我们可以使用apply方法，如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [181]: df</span><br><span class="line">Out[181]:</span><br><span class="line">        app_version  uid</span><br><span class="line">0  7.23.1-180522122    1</span><br><span class="line">1  7.20.1-180502135    2</span><br><span class="line">2  7.23.1-180522122    3</span><br><span class="line">3  7.23.1-180522122    4</span><br><span class="line">4  7.16.7-180411077    5</span><br><span class="line"></span><br><span class="line">In [182]: %%timeit</span><br><span class="line">     ...: df[&apos;app_version&apos;] = df[&apos;app_version&apos;].apply(lambda x: x.split(&apos;-&apos;)[0])</span><br><span class="line">     ...:</span><br><span class="line">247 µs ± 11.4 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)</span><br><span class="line"></span><br><span class="line">In [183]: df</span><br><span class="line">Out[183]:</span><br><span class="line">  app_version  uid</span><br><span class="line">0      7.23.1    1</span><br><span class="line">1      7.20.1    2</span><br><span class="line">2      7.23.1    3</span><br><span class="line">3      7.23.1    4</span><br><span class="line">4      7.16.7    5</span><br></pre></td></tr></table></figure></p>
<p>我们可以发现使用<code>apply</code>不仅使得代码更加简洁，而且速度也有了较明显的提升。但是以上方法本质上都是通过迭代的方式一条一条的修改，那么我们能否进一步提升性能呢？</p>
<h4>矢量化</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [197]: df</span><br><span class="line">Out[197]:</span><br><span class="line">        app_version  uid</span><br><span class="line">0  7.23.1-180522122    1</span><br><span class="line">1  7.20.1-180502135    2</span><br><span class="line">2  7.23.1-180522122    3</span><br><span class="line">3  7.23.1-180522122    4</span><br><span class="line">4  7.16.7-180411077    5</span><br><span class="line"></span><br><span class="line">In [198]: %%timeit</span><br><span class="line">     ...: df[&apos;app_version&apos;] = df[&apos;app_version&apos;].str.split(&apos;-&apos;).str.get(0)</span><br><span class="line">     ...:</span><br><span class="line">424 µs ± 11.3 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)</span><br></pre></td></tr></table></figure></p>
<p>这里发现矢量化貌似不能提高性能啊，这是为什么？</p>
<blockquote>
<p>这里我猜测是由于我们的矢量化代码是分为两步操作，且在数据量较小的情况下就会显得慢</p>
</blockquote>
<p>为了验证这个假设，我做了如下实验：
先将原数据concat为2560条记录，然后再计算时间
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">2557  7.23.1-180522122    3</span><br><span class="line">2558  7.23.1-180522122    4</span><br><span class="line">2559  7.16.7-180411077    5</span><br><span class="line"></span><br><span class="line">[2560 rows x 2 columns]</span><br><span class="line"></span><br><span class="line">In [232]: df3 = df</span><br><span class="line"></span><br><span class="line">In [233]: %%timeit</span><br><span class="line">     ...: df[&apos;app_version&apos;] = df[&apos;app_version&apos;].apply(lambda x: x.split(&apos;-&apos;)[0])</span><br><span class="line">     ...:</span><br><span class="line">1.36 ms ± 35.4 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)</span><br><span class="line"></span><br><span class="line"># 矢量化方式</span><br><span class="line">In [250]: %%timeit</span><br><span class="line">     ...: df[&apos;app_version&apos;] = df[&apos;app_version&apos;].str.split(&quot;-&quot;).str.get(0)</span><br><span class="line">     ...:</span><br><span class="line">2.61 ms ± 113 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</span><br></pre></td></tr></table></figure></p>
<p>发现单纯的数据量增大并没有影响结果，那么用其它转化来测试下，这里获取字符串长度的转化进行实验
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [253]: %%timeit</span><br><span class="line">     ...: df[&apos;length&apos;] = df[&apos;app_version&apos;].str.len()</span><br><span class="line">     ...:</span><br><span class="line">901 µs ± 17.5 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)</span><br><span class="line"></span><br><span class="line">In [254]: %%timeit</span><br><span class="line">     ...: df3[&apos;length&apos;] = df3[&apos;app_version&apos;].apply(lambda x: len(x))</span><br><span class="line">     ...:</span><br><span class="line">     ...:</span><br><span class="line">1.16 ms ± 14.7 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)</span><br></pre></td></tr></table></figure></p>
<p>我们看到在这里就体现出了矢量化的优势，因为这里大家都是一步。</p>
<p>结论：当矢量化步数只有一步时，其性能还是要比apply方式好的，但当需要多步的时候，不一定好于apply方式。</p>
<p>那么，我们能否将其转化为一步呢？后发现有extract这样的函数，使用如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [312]: df</span><br><span class="line">Out[312]:</span><br><span class="line">        app_version  uid</span><br><span class="line">0  7.23.1-180522122    1</span><br><span class="line">1  7.20.1-180502135    2</span><br><span class="line">2  7.23.1-180522122    3</span><br><span class="line">3  7.23.1-180522122    4</span><br><span class="line">4  7.16.7-180411077    5</span><br><span class="line"></span><br><span class="line">In [313]: %%timeit</span><br><span class="line">     ...: df[&apos;app_version&apos;] = df[&apos;app_version&apos;].str.extract(r&quot;([0-9\.]+)-[0-9]+&quot;, expand=Fal</span><br><span class="line">     ...: se)</span><br><span class="line">     ...:</span><br><span class="line">247 µs ± 8.95 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)</span><br></pre></td></tr></table></figure></p>
<p>通过<code>extract</code>终于实现了一步的矢量化。而且性能上也是最优的。</p>
<blockquote>
<p>这里需要注意的是，如果使用timeit, 由于多次操作，会导致后续df中'app_version'的值变为NaN。当我们只操作一次的时候则不存在此问题。</p>
</blockquote>
<h2>References</h2>
<ul>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/text.html" target="_blank" rel="noopener">Working with text data</a></li>
<li><a href="https://jakevdp.github.io/PythonDataScienceHandbook/03.10-working-with-strings.html" target="_blank" rel="noopener">Working with strings</a></li>
<li><a href="https://python.freelycode.com/contribution/detail/1083" target="_blank" rel="noopener">优化Pandas代码执行速度入门指南</a></li>
<li><a href="https://blog.csdn.net/u010814042/article/details/76401133" target="_blank" rel="noopener">Pandas 中map, applymap and apply的区别</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/16/Pandas系列3-DataFrame之增加与删除/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="geekpy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geekpy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/16/Pandas系列3-DataFrame之增加与删除/" itemprop="url">
                  Pandas系列3-DataFrame之增加与删除
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-16 18:18:18" itemprop="dateCreated datePublished" datetime="2018-06-16T18:18:18+08:00">2018-06-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-08-12 18:05:38" itemprop="dateModified" datetime="2018-08-12T18:05:38+08:00">2018-08-12</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/16/Pandas系列3-DataFrame之增加与删除/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2018/06/16/Pandas系列3-DataFrame之增加与删除/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在使用Pandas的过程增删改查是频繁使用的操作，这一节主要就是展示DataFrame常用的增加和删除操作</p>
<p>&lt;!--more--&gt;</p>
<h2>增加行和增加列</h2>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># 增加一列，我们可以有两种方式，如下：</span><br><span class="line">In [345]: df</span><br><span class="line">Out[345]:</span><br><span class="line">   one  two</span><br><span class="line">a    0    1</span><br><span class="line">b    4    5</span><br><span class="line">c    8    9</span><br><span class="line">d   12   13</span><br><span class="line"></span><br><span class="line">In [346]: df[&apos;three&apos;] = [3, 5, 5, 7]</span><br><span class="line"></span><br><span class="line">In [347]: df</span><br><span class="line">Out[347]:</span><br><span class="line">   one  two  three</span><br><span class="line">a    0    1      3</span><br><span class="line">b    4    5      5</span><br><span class="line">c    8    9      5</span><br><span class="line">d   12   13      7</span><br><span class="line"></span><br><span class="line"># 或者使用loc</span><br><span class="line">In [369]: df</span><br><span class="line">Out[369]:</span><br><span class="line">   one  two  three</span><br><span class="line">a    0    1      2</span><br><span class="line">b    4    5      6</span><br><span class="line">c    8    9     10</span><br><span class="line">d   12   13     14</span><br><span class="line"></span><br><span class="line">In [370]: df.loc[:, &quot;four&quot;] = [1, 4, 5, 9]</span><br><span class="line"></span><br><span class="line">In [371]: df</span><br><span class="line">Out[371]:</span><br><span class="line">   one  two  three  four</span><br><span class="line">a    0    1      2     1</span><br><span class="line">b    4    5      6     4</span><br><span class="line">c    8    9     10     5</span><br><span class="line">d   12   13     14     9</span><br></pre></td></tr></table></figure></p>
<p>需要注意的是使用如上两种方式增加一列的时候，其数组的长度必须与原有DataFrame的行数相同，否则会报如下错误
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ValueError: Length of values does not match length of index</span><br></pre></td></tr></table></figure></p>
<p>增加行同样我们也可以使用loc, 如下:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [376]: df</span><br><span class="line">Out[376]:</span><br><span class="line">   one  two  three  four</span><br><span class="line">a    0    1      2     3</span><br><span class="line">b    4    5      6     7</span><br><span class="line">c    8    9     10    11</span><br><span class="line">d   12   13     14    15</span><br><span class="line"></span><br><span class="line">In [377]: df.loc[&apos;e&apos;] = [3, 7, 8, 9]</span><br><span class="line"></span><br><span class="line">In [378]: df</span><br><span class="line">Out[378]:</span><br><span class="line">   one  two  three  four</span><br><span class="line">a    0    1      2     3</span><br><span class="line">b    4    5      6     7</span><br><span class="line">c    8    9     10    11</span><br><span class="line">d   12   13     14    15</span><br><span class="line">e    3    7      8     9</span><br></pre></td></tr></table></figure></p>
<p>但很多时候，我们并不需要row index, 只想自动增加一行，那么可以通过如下的方式</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [379]: df.loc[df.shape[0]+1] = [3, 5, 9, 9]</span><br><span class="line"></span><br><span class="line">In [380]: df</span><br><span class="line">Out[380]:</span><br><span class="line">   one  two  three  four</span><br><span class="line">a    0    1      2     3</span><br><span class="line">b    4    5      6     7</span><br><span class="line">c    8    9     10    11</span><br><span class="line">d   12   13     14    15</span><br><span class="line">e    3    7      8     9</span><br><span class="line">6    3    5      9     9</span><br></pre></td></tr></table></figure></p>
<p>另外，我们还可以将数据转化为Series，然后利用concat或者append的方式将其与原有的DataFrame进行合并。这种方式不仅可以添加一行数据，也可以一次性添加多行数据。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [392]: df = pd.DataFrame(np.arange(16).reshape((4,4)), index=[1, 2, 3, 4], columns=[&apos;a&apos;,</span><br><span class="line">     ...:  &apos;b&apos;, &apos;c&apos;,&apos;d&apos;])</span><br><span class="line"></span><br><span class="line">In [393]: df2 = pd.DataFrame(np.arange(16).reshape((4,4)), index=[5, 6, 7, 8], columns=[&apos;a&apos;</span><br><span class="line">     ...: , &apos;b&apos;, &apos;c&apos;,&apos;d&apos;])</span><br><span class="line"></span><br><span class="line"># 这里相当于添加了多行数据</span><br><span class="line">In [394]: pd.concat([df, df2])</span><br><span class="line">Out[394]:</span><br><span class="line">    a   b   c   d</span><br><span class="line">1   0   1   2   3</span><br><span class="line">2   4   5   6   7</span><br><span class="line">3   8   9  10  11</span><br><span class="line">4  12  13  14  15</span><br><span class="line">5   0   1   2   3</span><br><span class="line">6   4   5   6   7</span><br><span class="line">7   8   9  10  11</span><br><span class="line">8  12  13  14  15</span><br></pre></td></tr></table></figure></p>
<p>更多关于concat和append将在后续的章节详细讲解。</p>
<h2>删除行和删除列</h2>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">In [751]: df</span><br><span class="line">Out[751]:</span><br><span class="line">           age  color    food  height  score state</span><br><span class="line">Jane        30   blue   Steak     178    4.6    NY</span><br><span class="line">Nick         2  green    Lamb     181    8.3    TX</span><br><span class="line">Aaron       12    red   Mango     178    9.0    FL</span><br><span class="line">Penelope     4  white   Apple     178    3.3    AL</span><br><span class="line">Dean        32   gray  Cheese     175    1.8    AK</span><br><span class="line">Christina   33  black   Melon     178    9.5    TX</span><br><span class="line">Cornelia    69    red   Beans     178    2.2    TX</span><br><span class="line"></span><br><span class="line"># 使用drop删除index为&apos;Dean&apos;的行</span><br><span class="line">In [752]: df.drop([&apos;Dean&apos;])</span><br><span class="line">Out[752]:</span><br><span class="line">           age  color   food  height  score state</span><br><span class="line">Jane        30   blue  Steak     178    4.6    NY</span><br><span class="line">Nick         2  green   Lamb     181    8.3    TX</span><br><span class="line">Aaron       12    red  Mango     178    9.0    FL</span><br><span class="line">Penelope     4  white  Apple     178    3.3    AL</span><br><span class="line">Christina   33  black  Melon     178    9.5    TX</span><br><span class="line">Cornelia    69    red  Beans     178    2.2    TX</span><br><span class="line"></span><br><span class="line">In [749]: df</span><br><span class="line">Out[749]:</span><br><span class="line">           age  color    food  height  score state</span><br><span class="line">Jane        30   blue   Steak     178    4.6    NY</span><br><span class="line">Nick         2  green    Lamb     181    8.3    TX</span><br><span class="line">Aaron       12    red   Mango     178    9.0    FL</span><br><span class="line">Penelope     4  white   Apple     178    3.3    AL</span><br><span class="line">Dean        32   gray  Cheese     175    1.8    AK</span><br><span class="line">Christina   33  black   Melon     178    9.5    TX</span><br><span class="line">Cornelia    69    red   Beans     178    2.2    TX</span><br><span class="line"></span><br><span class="line"># 使用drop删除名为&apos;height&apos;的列，注意需要使用axis=1</span><br><span class="line"># 使用inplace来空值是在同一块内存还是copy</span><br><span class="line">In [750]: df.drop([&apos;height&apos;], axis=1, inplace=True)</span><br><span class="line">Out[750]:</span><br><span class="line">           age  color    food  score state</span><br><span class="line">Jane        30   blue   Steak    4.6    NY</span><br><span class="line">Nick         2  green    Lamb    8.3    TX</span><br><span class="line">Aaron       12    red   Mango    9.0    FL</span><br><span class="line">Penelope     4  white   Apple    3.3    AL</span><br><span class="line">Dean        32   gray  Cheese    1.8    AK</span><br><span class="line">Christina   33  black   Melon    9.5    TX</span><br><span class="line">Cornelia    69    red   Beans    2.2    TX</span><br><span class="line"></span><br><span class="line"># drop多列</span><br><span class="line">df.drop([&apos;height&apos;, &apos;food&apos;], axis=1, inplace=True)</span><br></pre></td></tr></table></figure></p>
<h2>条件删除</h2>
<p>由于在数据清洗的过程中经常需要删除不符合条件的record，所以以下这种条件过滤行就非常有用。<strong>需要注意的是，这里是重新生成了一个DataFrame，而不是直接在原有的DataFrame上修改</strong>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [755]: df2 = df[df.color!=&apos;blue&apos;]</span><br><span class="line"></span><br><span class="line">In [756]: df2</span><br><span class="line">Out[756]:</span><br><span class="line">           age  color    food  height  score state</span><br><span class="line">Nick         2  green    Lamb     181    8.3    TX</span><br><span class="line">Aaron       12    red   Mango     178    9.0    FL</span><br><span class="line">Penelope     4  white   Apple     178    3.3    AL</span><br><span class="line">Dean        32   gray  Cheese     175    1.8    AK</span><br><span class="line">Christina   33  black   Melon     178    9.5    TX</span><br><span class="line">Cornelia    69    red   Beans     178    2.2    TX</span><br></pre></td></tr></table></figure></p>
<h2>去重</h2>
<p>使用<code>drop_duplicates</code>，我们可以去掉重复项，这是一个非常有用的函数，下面我们来详细分析下</p>
<ul>
<li>通过参数subset,指定去重比较时用哪些column。如果不指定则所有的数据都会比较，只有所有列的数据都一致的时候才会去掉，否则不会去掉，如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [459]: df_con2</span><br><span class="line">Out[459]:</span><br><span class="line">  uid  num1  num2</span><br><span class="line">0  a1     1   4.0</span><br><span class="line">1  a2     3   5.0</span><br><span class="line">2  b1     5   7.0</span><br><span class="line">0  a1     2   4.0</span><br><span class="line">1  a2     5   NaN</span><br><span class="line">2  a3     2   2.0</span><br><span class="line"></span><br><span class="line">In [460]: df_drop = df_con2.drop_duplicates()</span><br><span class="line"></span><br><span class="line">In [461]: df_drop</span><br><span class="line">Out[461]:</span><br><span class="line">  uid  num1  num2</span><br><span class="line">0  a1     1   4.0</span><br><span class="line">1  a2     3   5.0</span><br><span class="line">2  b1     5   7.0</span><br><span class="line">0  a1     2   4.0</span><br><span class="line">1  a2     5   NaN</span><br><span class="line">2  a3     2   2.0</span><br></pre></td></tr></table></figure></li>
</ul>
<p>我们可以让两个dataframe只比较uid列，只要这一列的数据重复，我们就认为重复，如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [462]: df_drop2 = df_con2.drop_duplicates(subset=&apos;uid&apos;)</span><br><span class="line"></span><br><span class="line">In [463]: df_drop2</span><br><span class="line">Out[463]:</span><br><span class="line">  uid  num1  num2</span><br><span class="line">0  a1     1   4.0</span><br><span class="line">1  a2     3   5.0</span><br><span class="line">2  b1     5   7.0</span><br><span class="line">2  a3     2   2.0</span><br></pre></td></tr></table></figure></p>
<ul>
<li>另外从上边的例子可以看出，其去重是去掉了后边出现的重复的项，我们也可以保留后边的项，将前边的项去掉，那么就需要使用keep参数。另外，我们也可以直接在DataFrame中进行去重，而不需要再另外copy一份数据，这可以通过<code>inplace=True</code>来实现，示例如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [453]: df_con</span><br><span class="line">Out[453]:</span><br><span class="line">  uid  num1  num2</span><br><span class="line">0  a1     1   4.0</span><br><span class="line">1  a2     3   5.0</span><br><span class="line">2  b1     5   7.0</span><br><span class="line">0  a1     2   4.0</span><br><span class="line">1  a2     5   NaN</span><br><span class="line">2  a3     2   2.0</span><br><span class="line"></span><br><span class="line"># 注意这里没有赋值操作，因为使用了inplace=True</span><br><span class="line"># 使用keep=&apos;last&apos;用于保存后边的数据，删除前边的重复项</span><br><span class="line">In [454]: df_con.drop_duplicates(subset=&apos;uid&apos;, keep=&apos;last&apos;, inplace=True)</span><br><span class="line"></span><br><span class="line">In [455]: df_con</span><br><span class="line">Out[455]:</span><br><span class="line">  uid  num1  num2</span><br><span class="line">2  b1     5   7.0</span><br><span class="line">0  a1     2   4.0</span><br><span class="line">1  a2     5   NaN</span><br><span class="line">2  a3     2   2.0</span><br></pre></td></tr></table></figure></li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/10715965/add-one-row-in-a-pandas-dataframe" target="_blank" rel="noopener">StackOverflow</a></li>
<li><a href="https://www.jianshu.com/p/67e67c7034f6" target="_blank" rel="noopener">删除行和列</a></li>
<li><a href="http://pandas.pydata.org/pandas-docs/stable/merging.html" target="_blank" rel="noopener">Merging</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/15/Pandas系列2-DataFrame之数据定位/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="geekpy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geekpy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/15/Pandas系列2-DataFrame之数据定位/" itemprop="url">
                  Pandas系列2-DataFrame之数据定位
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-15 18:18:18" itemprop="dateCreated datePublished" datetime="2018-06-15T18:18:18+08:00">2018-06-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-08-12 18:05:16" itemprop="dateModified" datetime="2018-08-12T18:05:16+08:00">2018-08-12</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/15/Pandas系列2-DataFrame之数据定位/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2018/06/15/Pandas系列2-DataFrame之数据定位/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Pandas中我们往往需要先定位数据才能进行相应的赋值、修改等后续操作，因此定位是Pandas中非常重要的一环，本文将详解Pandas中的各种定位方式。</p>
<p>&lt;!--more--&gt;</p>
<p>在Pandas中我们主要通过以下几个函数来定位DataFrame中的特定数据</p>
<ul>
<li>iloc</li>
<li>loc</li>
<li>iat</li>
<li>at</li>
</ul>
<p>总的来说，分为两种：</p>
<ol>
<li>
<p>一种是通过lables(即row index和column names，这里row index可以字符，日期等非数字index)(使用loc, at);</p>
</li>
<li>
<p>另一种通过index(这里特指数字位置index)(使用iloc, iat)</p>
</li>
</ol>
<p>loc和at的区别在于， loc可以选择特定的行或列，但是at只能定位某个特定的值，标量值。一般情况下，我们iloc和loc更加通用，而at, iat有一定的性能提升。</p>
<p>具体示例可以参考Reference中StackOverflow的示例
下面展示一些特别的：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">In [630]: df</span><br><span class="line">Out[630]:</span><br><span class="line">           age  color    food  height  score state</span><br><span class="line">Jane        30   blue   Steak     165    4.6    NY</span><br><span class="line">Nick         2  green    Lamb      70    8.3    TX</span><br><span class="line">Aaron       12    red   Mango     120    9.0    FL</span><br><span class="line">Penelope     4  white   Apple      80    3.3    AL</span><br><span class="line">Dean        32   gray  Cheese     180    1.8    AK</span><br><span class="line">Christina   33  black   Melon     172    9.5    TX</span><br><span class="line">Cornelia    69    red   Beans     150    2.2    TX</span><br><span class="line"></span><br><span class="line"># 选择某一行数据</span><br><span class="line">In [631]: df.loc[&apos;Dean&apos;]</span><br><span class="line">Out[631]:</span><br><span class="line">age           32</span><br><span class="line">color       gray</span><br><span class="line">food      Cheese</span><br><span class="line">height       180</span><br><span class="line">score        1.8</span><br><span class="line">state         AK</span><br><span class="line">Name: Dean, dtype: object</span><br><span class="line"></span><br><span class="line"># 选择某一列数据，逗号前面是行的label，逗号后边是列的label，使用&quot;:&quot;来表示选取所有的，本例是选取所有的行，当&apos;:&apos;在逗号后边时表示选取所有的列，但通常我们可以省略。</span><br><span class="line">In [241]: df.loc[:, &apos;color&apos;]</span><br><span class="line">Out[241]:</span><br><span class="line">Jane          blue</span><br><span class="line">Nick         green</span><br><span class="line">Aaron          red</span><br><span class="line">Penelope     white</span><br><span class="line">Dean          gray</span><br><span class="line">Christina    black</span><br><span class="line">Cornelia       red</span><br><span class="line">Name: color, dtype: object</span><br><span class="line"># 也可以如下选取一列，但是与前者是有区别的，具体参考Reference中的《Returning a view versus a copy》</span><br><span class="line">In [632]: df.loc[:][&apos;color&apos;]</span><br><span class="line">Out[632]:</span><br><span class="line">Jane          blue</span><br><span class="line">Nick         green</span><br><span class="line">Aaron          red</span><br><span class="line">Penelope     white</span><br><span class="line">Dean          gray</span><br><span class="line">Christina    black</span><br><span class="line">Cornelia       red</span><br><span class="line">Name: color, dtype: object</span><br><span class="line"></span><br><span class="line"># 选择某几行数据，注意无论选择多行还是多列，都需要将其label放在一个数组当中，而选择单个行或列，则不需要放在数组当中</span><br><span class="line">In [634]: df.loc[[&apos;Nick&apos;, &apos;Dean&apos;]]</span><br><span class="line">Out[634]:</span><br><span class="line">      age  color    food  height  score state</span><br><span class="line">Nick    2  green    Lamb      70    8.3    TX</span><br><span class="line">Dean   32   gray  Cheese     180    1.8    AK</span><br><span class="line"></span><br><span class="line"># 注意以下这种用法不行，这是由于Pandas会认为逗号后边是列的label</span><br><span class="line">df.loc[&apos;Nick&apos;, &apos;Dean&apos;]</span><br><span class="line"></span><br><span class="line"># 选择范围</span><br><span class="line">In [636]: df.loc[&apos;Nick&apos;:&apos;Christina&apos;]</span><br><span class="line">Out[636]:</span><br><span class="line">           age  color    food  height  score state</span><br><span class="line">Nick         2  green    Lamb      70    8.3    TX</span><br><span class="line">Aaron       12    red   Mango     120    9.0    FL</span><br><span class="line">Penelope     4  white   Apple      80    3.3    AL</span><br><span class="line">Dean        32   gray  Cheese     180    1.8    AK</span><br><span class="line">Christina   33  black   Melon     172    9.5    TX</span><br><span class="line"></span><br><span class="line"># iloc的特定用法, 可以用-1这样index来获取最后一行的数据</span><br><span class="line">In [637]: df.iloc[[1, -1]]</span><br><span class="line">Out[637]:</span><br><span class="line">          age  color   food  height  score state</span><br><span class="line">Nick        2  green   Lamb      70    8.3    TX</span><br><span class="line">Cornelia   69    red  Beans     150    2.2    TX</span><br></pre></td></tr></table></figure></p>
<p>数据定位是后续条件过滤、赋值以及各种转换的基础，一定要熟练掌握。</p>
<p>另外，在定位某一个具体的元素的时候，loc和at并不完全相同</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># loc支持以下两种定位方式</span><br><span class="line">In [726]: df.loc[&apos;Jane&apos;, &apos;score&apos;]</span><br><span class="line">Out[726]: 4.6</span><br><span class="line"></span><br><span class="line">In [727]: df.loc[&apos;Jane&apos;][&apos;score&apos;]</span><br><span class="line">Out[727]: 4.6</span><br><span class="line"></span><br><span class="line"># 但是at只支持第一种定位方式</span><br><span class="line">In [729]: df.at[&apos;Nick&apos;, &apos;height&apos;]</span><br><span class="line">Out[729]: 181</span><br><span class="line"></span><br><span class="line">In [730]: df.at[&apos;Nick&apos;][&apos;height&apos;]</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-730-948408df1727&gt; in &lt;module&gt;()</span><br><span class="line">----&gt; 1 df.at[&apos;Nick&apos;][&apos;height&apos;]</span><br><span class="line"></span><br><span class="line">~/.pyenv/versions/3.6.4/envs/data_analysis/lib/python3.6/site-packages/pandas/core/indexing.py in __getitem__(self, key)</span><br><span class="line">   1867</span><br><span class="line">   1868         key = self._convert_key(key)</span><br><span class="line">-&gt; 1869         return self.obj._get_value(*key, takeable=self._takeable)</span><br><span class="line">   1870</span><br><span class="line">   1871     def __setitem__(self, key, value):</span><br><span class="line"></span><br><span class="line">TypeError: _get_value() missing 1 required positional argument: &apos;col&apos;</span><br></pre></td></tr></table></figure></p>
<p>有两点需要说明：</p>
<ul>
<li>在针对特定元素赋值的时候最好使用at来进行操作，性能提升还是很明显的。</li>
<li>loc的两种方式并不等同，<code>df.loc['Jane', 'score']</code>是在同一块内存中对数据进行操作，而<code>df.loc['Jane']['score']</code>是在另一个copy上进行操作，具体参考<a href="http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy" target="_blank" rel="noopener">Returning a view versus a copy</a></li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/28757389/loc-vs-iloc-vs-ix-vs-at-vs-iat" target="_blank" rel="noopener">StackOverflow: iloc vs. loc vs. iat vs. at</a></li>
<li><a href="http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy" target="_blank" rel="noopener">Returning a view versus a copy</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/08/Pandas系列1-DataFrame之初始化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="geekpy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geekpy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/08/Pandas系列1-DataFrame之初始化/" itemprop="url">
                  Pandas系列1-DataFrame之初始化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-08 18:18:18" itemprop="dateCreated datePublished" datetime="2018-06-08T18:18:18+08:00">2018-06-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-05 22:17:12" itemprop="dateModified" datetime="2018-10-05T22:17:12+08:00">2018-10-05</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/08/Pandas系列1-DataFrame之初始化/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2018/06/08/Pandas系列1-DataFrame之初始化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Pandas中如果要初始化DataFrame对象，实际又很多种方式，本文将详解Pandas初始化的几种不同方式。</p>
<p>&lt;!--more--&gt;</p>
<p>DataFrame有多种初始化方法，主要分为以下几种情况：</p>
<ul>
<li>通过Object初始化</li>
<li>通过文件初始化</li>
<li>通过SQL查询结果初始化</li>
<li>通过NoSQL数据库查询结果初始化</li>
</ul>
<p>下面分别介绍：</p>
<h2>通过object初始化</h2>
<p>这又分为以下几种方式</p>
<ul>
<li>Dict of 1D ndarrays, lists, dicts, or Series</li>
<li>2-D numpy.ndarray</li>
<li>Structured or record ndarray</li>
<li>A Series</li>
<li>Another DataFrame</li>
</ul>
<h4>通过list</h4>
<p>通过1D data series初始化的时候，如果有多列，那么需要等长
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># columns参数是通过一个list参数来指定column labels</span><br><span class="line">df = pd.<span class="symbol">DataFrame</span>([[<span class="string">'a1'</span>, <span class="number">1</span>], [<span class="string">'a2'</span>, <span class="number">4</span>]], columns=[<span class="string">'uid'</span>, <span class="string">'score'</span>])</span><br><span class="line"><span class="symbol">In</span> [<span class="number">477</span>]: df</span><br><span class="line"><span class="symbol">Out</span>[<span class="number">477</span>]:</span><br><span class="line">  uid  score</span><br><span class="line"><span class="number">0</span>  a1      <span class="number">1</span></span><br><span class="line"><span class="number">1</span>  a2      <span class="number">4</span></span><br></pre></td></tr></table></figure></p>
<h4>通过Dict of 1D ndarray</h4>
<p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">In</span> [<span class="number">298</span>]: df = pd.DataFrame(&#123;<span class="symbol">'col1</span>': np.arange(<span class="number">3</span>), <span class="symbol">'col2</span>': np.arange(<span class="number">5</span>, <span class="number">8</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> [<span class="number">299</span>]: df</span><br><span class="line"><span class="keyword">Out</span>[<span class="number">299</span>]:</span><br><span class="line">   col1  col2</span><br><span class="line"><span class="number">0</span>     <span class="number">0</span>     <span class="number">5</span></span><br><span class="line"><span class="number">1</span>     <span class="number">1</span>     <span class="number">6</span></span><br><span class="line"><span class="number">2</span>     <span class="number">2</span>     <span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<h4>通过Dict of lists</h4>
<p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">In</span> [<span class="number">294</span>]: df = pd.<span class="symbol">DataFrame</span>(&#123;<span class="string">'col1'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="string">'col2'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="symbol">In</span> [<span class="number">295</span>]: df</span><br><span class="line"><span class="symbol">Out</span>[<span class="number">295</span>]:</span><br><span class="line">   col1 col2</span><br><span class="line"><span class="number">0</span>     <span class="number">1</span>    a</span><br><span class="line"><span class="number">1</span>     <span class="number">2</span>    b</span><br><span class="line"><span class="number">2</span>     <span class="number">3</span>    c</span><br><span class="line"><span class="number">3</span>     <span class="number">4</span>    d</span><br></pre></td></tr></table></figure></p>
<h4>通过list of dicts</h4>
<p>注意与上边的dict of lists区分，如果最外层是dict，那么key值默认是column label。
而在list of dicts中，每个dict都是一个record，或者说一行
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 可以不等长，缺失值自动设为<span class="symbol">NaN</span></span><br><span class="line"><span class="symbol">In</span> [<span class="number">49</span>]: data2 = [&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;, &#123;<span class="string">'a'</span>: <span class="number">5</span>, <span class="string">'b'</span>: <span class="number">10</span>, <span class="string">'c'</span>: <span class="number">20</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="symbol">In</span> [<span class="number">50</span>]: pd.<span class="symbol">DataFrame</span>(data2)</span><br><span class="line"><span class="symbol">Out</span>[<span class="number">50</span>]: </span><br><span class="line">   a   b     c</span><br><span class="line"><span class="number">0</span>  <span class="number">1</span>   <span class="number">2</span>   <span class="symbol">NaN</span></span><br><span class="line"><span class="number">1</span>  <span class="number">5</span>  <span class="number">10</span>  <span class="number">20.0</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">In</span> [<span class="number">51</span>]: pd.<span class="symbol">DataFrame</span>(data2, index=[<span class="string">'first'</span>, <span class="string">'second'</span>])</span><br><span class="line"><span class="symbol">Out</span>[<span class="number">51</span>]: </span><br><span class="line">        a   b     c</span><br><span class="line">first   <span class="number">1</span>   <span class="number">2</span>   <span class="symbol">NaN</span></span><br><span class="line">second  <span class="number">5</span>  <span class="number">10</span>  <span class="number">20.0</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">In</span> [<span class="number">52</span>]: pd.<span class="symbol">DataFrame</span>(data2, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>])</span><br><span class="line"><span class="symbol">Out</span>[<span class="number">52</span>]: </span><br><span class="line">   a   b</span><br><span class="line"><span class="number">0</span>  <span class="number">1</span>   <span class="number">2</span></span><br><span class="line"><span class="number">1</span>  <span class="number">5</span>  <span class="number">10</span></span><br></pre></td></tr></table></figure></p>
<h4>通过Dict of Series</h4>
<p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">In</span> [<span class="number">314</span>]: s = pd.Series(<span class="keyword">range</span>(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> [<span class="number">315</span>]: s</span><br><span class="line"><span class="keyword">Out</span>[<span class="number">315</span>]:</span><br><span class="line"><span class="number">0</span>    <span class="number">0</span></span><br><span class="line"><span class="number">1</span>    <span class="number">1</span></span><br><span class="line"><span class="number">2</span>    <span class="number">2</span></span><br><span class="line"><span class="number">3</span>    <span class="number">3</span></span><br><span class="line"><span class="number">4</span>    <span class="number">4</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> [<span class="number">316</span>]: p = pd.Series(<span class="keyword">range</span>(<span class="number">8</span>, <span class="number">13</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> [<span class="number">317</span>]: p</span><br><span class="line"><span class="keyword">Out</span>[<span class="number">317</span>]:</span><br><span class="line"><span class="number">0</span>     <span class="number">8</span></span><br><span class="line"><span class="number">1</span>     <span class="number">9</span></span><br><span class="line"><span class="number">2</span>    <span class="number">10</span></span><br><span class="line"><span class="number">3</span>    <span class="number">11</span></span><br><span class="line"><span class="number">4</span>    <span class="number">12</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> [<span class="number">318</span>]: df = pd.DataFrame(&#123;<span class="string">'a'</span>: s, <span class="string">'b'</span>: p&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> [<span class="number">319</span>]: df</span><br><span class="line"><span class="keyword">Out</span>[<span class="number">319</span>]:</span><br><span class="line">   a   b</span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>   <span class="number">8</span></span><br><span class="line"><span class="number">1</span>  <span class="number">1</span>   <span class="number">9</span></span><br><span class="line"><span class="number">2</span>  <span class="number">2</span>  <span class="number">10</span></span><br><span class="line"><span class="number">3</span>  <span class="number">3</span>  <span class="number">11</span></span><br><span class="line"><span class="number">4</span>  <span class="number">4</span>  <span class="number">12</span></span><br></pre></td></tr></table></figure></p>
<h4>通过2-D numpy.ndarray</h4>
<p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">289</span>]: df = pd.DataFrame(np.arange(<span class="number">16</span>).reshape((<span class="number">4</span>,<span class="number">4</span>)), columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>,</span><br><span class="line">     ...:  <span class="string">'four'</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">290</span>]: df</span><br><span class="line">Out[<span class="number">290</span>]:</span><br><span class="line">   <span class="literal">one</span>  <span class="literal">two</span>  <span class="literal">three</span>  <span class="literal">four</span></span><br><span class="line"><span class="keyword">a</span>    <span class="number">0</span>    <span class="number">1</span>      <span class="number">2</span>     <span class="number">3</span></span><br><span class="line">b    <span class="number">4</span>    <span class="number">5</span>      <span class="number">6</span>     <span class="number">7</span></span><br><span class="line">c    <span class="number">8</span>    <span class="number">9</span>     <span class="number">10</span>    <span class="number">11</span></span><br><span class="line">d   <span class="number">12</span>   <span class="number">13</span>     <span class="number">14</span>    <span class="number">15</span></span><br></pre></td></tr></table></figure></p>
<h2>通过文件初始化</h2>
<p>pandas通过各种数据文件也可以初始化，比如csv文件，excel文件，json文件，html文件等，详见下图
<img src="https://upload-images.jianshu.io/upload_images/3959253-4ebb77efcd970e59.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IO Tools"></p>
<p>下面以<code>read_csv</code>详细解释下读取csv文件以及初始化的过程
<code>read_csv</code>的完整文档参考<a href="https://pandas.pydata.org/pandas-docs/version/0.22/generated/pandas.read_csv.html#pandas.read_csv" target="_blank" rel="noopener">read_csv api</a>，下面通过示例对常用的parameter进行解释：</p>
<p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">csv_path = <span class="string">"./test.csv"</span></span><br><span class="line"><span class="attribute">columns</span> = [<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line">dtype = &#123;<span class="string">'id'</span>: int, <span class="string">'name'</span>: <span class="selector-tag">object</span>, <span class="string">'age'</span>: int&#125;</span><br><span class="line">pd.read_csv(csv_path, header=None, names=<span class="attribute">columns</span>, dtype=dtype)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>filepath_or_buffer, 这个是最基本的参数，用以指明文件的路径(路径可以是字符串，也可以是各种path对象，详见文档)或者文件对象(也可以接收类文件对象, 即提供read method， 如StringIO对象)。另外，这个参数也可以是一个URL，而这个URL可以http, ftp, 或者s3的url.</li>
</ul>
<blockquote>
<p>对于没有权限限制的url，直接使用read_csv可以大大简化代码，但是通过我们的数据不会放置到公开的url地址上，因此这就涉及权限的问题，通常还是通过其它手段将文件下载到本地后再读取。</p>
</blockquote>
<ul>
<li>header, 这个参数用于设置第几行为column names, 默认是'infer'，即Pandas会自动推断哪一行是column names。当文件中没有column names时，相当于设定header=0。很多时候想要忽略原始的column names而自己设定column names，那么可以将这个参数设置为None, 然后通过names参数来设定column names</li>
<li>names, 用于设定column names</li>
<li>dtype, 用于设定每一列对应的数据类型，需要注意的是对string类型需要设置为object</li>
<li>nrows, 要读取多少行，通过这个参数我们可以部分读取文件</li>
<li>usecols, 用于选定列，即指定哪些列load进DataFrame中，通过这个参数可以只读取我们需要的数据，从而减少内存占用，加快load速度。</li>
</ul>
<h2>通过SQL查询结果初始化</h2>
<p><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas.io.sql <span class="keyword">as</span> sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># conn是数据库的连接对象</span></span><br><span class="line">sql.read_frame('select * <span class="keyword">from</span> test', conn)</span><br></pre></td></tr></table></figure></p>
<h2>NoSQL查询结果初始化</h2>
<p>这里以MongoDB为例
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从MongoDB中查询年龄大于20岁的用户，查询返回一个cursor对象</span></span><br><span class="line"><span class="attr">user_results</span> = user.find(&#123;<span class="string">"age"</span>: &#123;<span class="string">"$gt"</span>: <span class="number">20</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将cursor对象转化为list，然后初始化</span></span><br><span class="line"><span class="comment"># columns可以用于选取相应的field的数据，只有在这个列表中的field才会被load进DataFrame对象当中，如果没有对应的数据，会被填入NaN</span></span><br><span class="line"><span class="attr">df</span> = pd.DataFrame(list(user_results), columns=[<span class="string">'id'</span>, <span class="string">'age'</span>, <span class="string">'name'</span>]</span><br></pre></td></tr></table></figure></p>
<p>这里需要注意的是如果不指定columns参数，有可能导致某些为空的field没有对应的列，如果指定了列名称，则如果相对应的域没有数据的话，就会自动置为nan</p>
<h2>References</h2>
<ul>
<li><a href="https://pandas.pydata.org/pandas-docs/version/0.22/generated/pandas.read_csv.html#pandas.read_csv" target="_blank" rel="noopener">read_csv API</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/version/0.22/io.html#io-read-csv-table" target="_blank" rel="noopener">IO Tools</a></li>
<li>《利用Python进行数据分析》</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">geekpy</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">28</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/geekpy" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:rebor.liu@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">geekpy</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a> v6.4.2</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'OCjgmQiFa9gpVkDabM6KTb8g-gzGzoHsz',
        appKey: 'Ie7XE2V6spB6Q6C1W2GU9drV',
        placeholder: 'Just go go',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: false
    });
  </script>



  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
